(()=>{var aI={442:(J,oe,U)=>{"use strict";function K(y,D={}){const{start:C=0,end:k=y.length}=D,M=D.size||2;let L=0;for(let P=C,$=k-M;P<k;P+=M)L+=(y[P]-y[$])*(y[P+1]+y[$+1]),$=P;return L/2}function Y(y,D,C=2,k){const M=D&&D.length,L=M?D[0]*C:y.length;let P=Ke(y,0,L,C,!0,k&&k[0]);const $=[];if(!P||P.next===P.prev)return $;let _e,Ie,De,gt,Dt,Ne,Ae;if(M&&(P=function dn(y,D,C,k,M){const L=[];let P,$,_e,Ie,De;for(P=0,$=D.length;P<$;P++)_e=D[P]*k,Ie=P<$-1?D[P+1]*k:y.length,De=Ke(y,_e,Ie,k,!1,M&&M[P+1]),De===De.next&&(De.steiner=!0),L.push(Vt(De));for(L.sort(qe),P=0;P<L.length;P++)X(L[P],C),C=se(C,C.next);return C}(y,D,P,C,k)),y.length>80*C){gt=Ie=y[0],Dt=De=y[1];for(let er=C;er<L;er+=C)Ne=y[er],Ae=y[er+1],Ne<gt&&(gt=Ne),Ae<Dt&&(Dt=Ae),Ne>Ie&&(Ie=Ne),Ae>De&&(De=Ae);_e=Math.max(Ie-gt,De-Dt),_e=0!==_e?1/_e:0}return Te(P,$,C,gt,Dt,_e),$}function Ke(y,D,C,k,M,L){let P,$;if(void 0===L&&(L=K(y,{start:D,end:C,size:k})),M===L<0)for(P=D;P<C;P+=k)$=Ur(P,y[P],y[P+1],$);else for(P=C-k;P>=D;P-=k)$=Ur(P,y[P],y[P+1],$);return $&&Jn($,$.next)&&(jt($),$=$.next),$}function se(y,D){if(!y)return y;D||(D=y);let k,C=y;do{if(k=!1,C.steiner||!Jn(C,C.next)&&0!==je(C.prev,C,C.next))C=C.next;else{if(jt(C),C=D=C.prev,C===C.next)break;k=!0}}while(k||C!==D);return D}function Te(y,D,C,k,M,L,P){if(!y)return;!P&&L&&function fn(y,D,C,k){let M=y;do{null===M.z&&(M.z=Yn(M.x,M.y,D,C,k)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next}while(M!==y);M.prevZ.nextZ=null,M.prevZ=null,function pt(y){let D,C,M,L,P,$,_e,Ie,k=1;do{for(L=y,y=null,Ie=null,M=0;L;){for(M++,$=L,P=0,C=0;C<k&&(P++,$=$.nextZ,$);C++);for(_e=k;P>0||_e>0&&$;)0!==P&&(0===_e||!$||L.z<=$.z)?(D=L,L=L.nextZ,P--):(D=$,$=$.nextZ,_e--),Ie?Ie.nextZ=D:y=D,D.prevZ=Ie,Ie=D;L=$}Ie.nextZ=null,k*=2}while(M>1)}(M)}(y,k,M,L);let _e,Ie,$=y;for(;y.prev!==y.next;)if(_e=y.prev,Ie=y.next,L?He(y,k,M,L):_t(y))D.push(_e.i/C),D.push(y.i/C),D.push(Ie.i/C),jt(y),y=Ie.next,$=Ie.next;else if((y=Ie)===$){P?1===P?Te(y=ht(se(y),D,C),D,C,k,M,L,2):2===P&&Ct(y,D,C,k,M,L):Te(se(y),D,C,k,M,L,1);break}}function _t(y){const D=y.prev,C=y,k=y.next;if(je(D,C,k)>=0)return!1;let M=y.next.next;for(;M!==y.prev;){if(Vn(D.x,D.y,C.x,C.y,k.x,k.y,M.x,M.y)&&je(M.prev,M,M.next)>=0)return!1;M=M.next}return!0}function He(y,D,C,k){const M=y.prev,L=y,P=y.next;if(je(M,L,P)>=0)return!1;const Ie=M.x>L.x?M.x>P.x?M.x:P.x:L.x>P.x?L.x:P.x,De=M.y>L.y?M.y>P.y?M.y:P.y:L.y>P.y?L.y:P.y,gt=Yn(M.x<L.x?M.x<P.x?M.x:P.x:L.x<P.x?L.x:P.x,M.y<L.y?M.y<P.y?M.y:P.y:L.y<P.y?L.y:P.y,D,C,k),Dt=Yn(Ie,De,D,C,k);let Ne=y.prevZ,Ae=y.nextZ;for(;Ne&&Ne.z>=gt&&Ae&&Ae.z<=Dt;){if(Ne!==y.prev&&Ne!==y.next&&Vn(M.x,M.y,L.x,L.y,P.x,P.y,Ne.x,Ne.y)&&je(Ne.prev,Ne,Ne.next)>=0||(Ne=Ne.prevZ,Ae!==y.prev&&Ae!==y.next&&Vn(M.x,M.y,L.x,L.y,P.x,P.y,Ae.x,Ae.y)&&je(Ae.prev,Ae,Ae.next)>=0))return!1;Ae=Ae.nextZ}for(;Ne&&Ne.z>=gt;){if(Ne!==y.prev&&Ne!==y.next&&Vn(M.x,M.y,L.x,L.y,P.x,P.y,Ne.x,Ne.y)&&je(Ne.prev,Ne,Ne.next)>=0)return!1;Ne=Ne.prevZ}for(;Ae&&Ae.z<=Dt;){if(Ae!==y.prev&&Ae!==y.next&&Vn(M.x,M.y,L.x,L.y,P.x,P.y,Ae.x,Ae.y)&&je(Ae.prev,Ae,Ae.next)>=0)return!1;Ae=Ae.nextZ}return!0}function ht(y,D,C){let k=y;do{const M=k.prev,L=k.next.next;!Jn(M,L)&&hr(M,k,k.next,L)&&Ue(M,L)&&Ue(L,M)&&(D.push(M.i/C),D.push(k.i/C),D.push(L.i/C),jt(k),jt(k.next),k=y=L),k=k.next}while(k!==y);return se(k)}function Ct(y,D,C,k,M,L){let P=y;do{let $=P.next.next;for(;$!==P.prev;){if(P.i!==$.i&&Zo(P,$)){let _e=jn(P,$);return P=se(P,P.next),_e=se(_e,_e.next),Te(P,D,C,k,M,L),void Te(_e,D,C,k,M,L)}$=$.next}P=P.next}while(P!==y)}function qe(y,D){return y.x-D.x}function X(y,D){if(D=function ke(y,D){let C=D;const k=y.x,M=y.y;let P,L=-1/0;do{if(M<=C.y&&M>=C.next.y&&C.next.y!==C.y){const Dt=C.x+(M-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if(Dt<=k&&Dt>L){if(L=Dt,Dt===k){if(M===C.y)return C;if(M===C.next.y)return C.next}P=C.x<C.next.x?C:C.next}}C=C.next}while(C!==D);if(!P)return null;if(k===L)return P;const $=P,_e=P.x,Ie=P.y;let gt,De=1/0;C=P;do{k>=C.x&&C.x>=_e&&k!==C.x&&Vn(M<Ie?k:L,M,_e,Ie,M<Ie?L:k,M,C.x,C.y)&&(gt=Math.abs(M-C.y)/(k-C.x),Ue(C,y)&&(gt<De||gt===De&&(C.x>P.x||C.x===P.x&&Xe(P,C)))&&(P=C,De=gt)),C=C.next}while(C!==$);return P}(y,D),D){const C=jn(D,y);se(D,D.next),se(C,C.next)}}function Xe(y,D){return je(y.prev,y,D.prev)<0&&je(D.next,y,y.next)<0}function Yn(y,D,C,k,M){return(y=1431655765&((y=858993459&((y=252645135&((y=16711935&((y=32767*(y-C)*M)|y<<8))|y<<4))|y<<2))|y<<1))|(D=1431655765&((D=858993459&((D=252645135&((D=16711935&((D=32767*(D-k)*M)|D<<8))|D<<4))|D<<2))|D<<1))<<1}function Vt(y){let D=y,C=y;do{(D.x<C.x||D.x===C.x&&D.y<C.y)&&(C=D),D=D.next}while(D!==y);return C}function Vn(y,D,C,k,M,L,P,$){return(M-P)*(D-$)-(y-P)*(L-$)>=0&&(y-P)*(k-$)-(C-P)*(D-$)>=0&&(C-P)*(L-$)-(M-P)*(k-$)>=0}function Zo(y,D){return y.next.i!==D.i&&y.prev.i!==D.i&&!function pr(y,D){let C=y;do{if(C.i!==y.i&&C.next.i!==y.i&&C.i!==D.i&&C.next.i!==D.i&&hr(C,C.next,y,D))return!0;C=C.next}while(C!==y);return!1}(y,D)&&(Ue(y,D)&&Ue(D,y)&&function $e(y,D){let C=y,k=!1;const M=(y.x+D.x)/2,L=(y.y+D.y)/2;do{C.y>L!=C.next.y>L&&C.next.y!==C.y&&M<(C.next.x-C.x)*(L-C.y)/(C.next.y-C.y)+C.x&&(k=!k),C=C.next}while(C!==y);return k}(y,D)&&(je(y.prev,y,D.prev)||je(y,D.prev,D))||Jn(y,D)&&je(y.prev,y,y.next)>0&&je(D.prev,D,D.next)>0)}function je(y,D,C){return(D.y-y.y)*(C.x-D.x)-(D.x-y.x)*(C.y-D.y)}function Jn(y,D){return y.x===D.x&&y.y===D.y}function hr(y,D,C,k){const M=rn(je(y,D,C)),L=rn(je(y,D,k)),P=rn(je(C,k,y)),$=rn(je(C,k,D));return!!(M!==L&&P!==$||0===M&&R(y,C,D)||0===L&&R(y,k,D)||0===P&&R(C,y,k)||0===$&&R(C,D,k))}function R(y,D,C){return D.x<=Math.max(y.x,C.x)&&D.x>=Math.min(y.x,C.x)&&D.y<=Math.max(y.y,C.y)&&D.y>=Math.min(y.y,C.y)}function rn(y){return y>0?1:y<0?-1:0}function Ue(y,D){return je(y.prev,y,y.next)<0?je(y,D,y.next)>=0&&je(y,y.prev,D)>=0:je(y,D,y.prev)<0||je(y,y.next,D)<0}function jn(y,D){const C=new Xn(y.i,y.x,y.y),k=new Xn(D.i,D.x,D.y),M=y.next,L=D.prev;return y.next=D,D.prev=y,C.next=M,M.prev=C,k.next=C,C.prev=k,L.next=k,k.prev=L,k}function Ur(y,D,C,k){const M=new Xn(y,D,C);return k?(M.next=k.next,M.prev=k,k.next.prev=M,k.next=M):(M.prev=M,M.next=M),M}function jt(y){y.next.prev=y.prev,y.prev.next=y.next,y.prevZ&&(y.prevZ.nextZ=y.nextZ),y.nextZ&&(y.nextZ.prevZ=y.prevZ)}function Xn(y,D,C){this.i=y,this.x=D,this.y=C,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}U.d(oe,{hY:()=>Y,IC:()=>K})},412:(J,oe,U)=>{"use strict";U.d(oe,{t:()=>G});var ie=U(413);class G extends ie.B{constructor(K){super(),this._value=K}get value(){return this.getValue()}_subscribe(K){const q=super._subscribe(K);return!q.closed&&K.next(this._value),q}getValue(){const{hasError:K,thrownError:q,_value:W}=this;if(K)throw q;return this._throwIfClosed(),W}next(K){super.next(this._value=K)}}},985:(J,oe,U)=>{"use strict";U.d(oe,{c:()=>xe});var ie=U(707),G=U(359),ce=U(494),K=U(203),q=U(26),W=U(71),Me=U(786);let xe=(()=>{class Y{constructor(se){se&&(this._subscribe=se)}lift(se){const Te=new Y;return Te.source=this,Te.operator=se,Te}subscribe(se,Te,_t){const He=function F(Y){return Y&&Y instanceof ie.vU||function z(Y){return Y&&(0,W.T)(Y.next)&&(0,W.T)(Y.error)&&(0,W.T)(Y.complete)}(Y)&&(0,G.Uv)(Y)}(se)?se:new ie.Ms(se,Te,_t);return(0,Me.Y)(()=>{const{operator:ht,source:Ct}=this;He.add(ht?ht.call(He,Ct):Ct?this._subscribe(He):this._trySubscribe(He))}),He}_trySubscribe(se){try{return this._subscribe(se)}catch(Te){se.error(Te)}}forEach(se,Te){return new(Te=me(Te))((_t,He)=>{const ht=new ie.Ms({next:Ct=>{try{se(Ct)}catch(dn){He(dn),ht.unsubscribe()}},error:He,complete:_t});this.subscribe(ht)})}_subscribe(se){var Te;return null===(Te=this.source)||void 0===Te?void 0:Te.subscribe(se)}[ce.s](){return this}pipe(...se){return(0,K.m)(se)(this)}toPromise(se){return new(se=me(se))((Te,_t)=>{let He;this.subscribe(ht=>He=ht,ht=>_t(ht),()=>Te(He))})}}return Y.create=Ke=>new Y(Ke),Y})();function me(Y){var Ke;return null!==(Ke=Y??q.$.Promise)&&void 0!==Ke?Ke:Promise}},413:(J,oe,U)=>{"use strict";U.d(oe,{B:()=>Me});var ie=U(985),G=U(359);const K=(0,U(853).L)(me=>function(){me(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var q=U(908),W=U(786);let Me=(()=>{class me extends ie.c{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(F){const Y=new xe(this,this);return Y.operator=F,Y}_throwIfClosed(){if(this.closed)throw new K}next(F){(0,W.Y)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const Y of this.currentObservers)Y.next(F)}})}error(F){(0,W.Y)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=F;const{observers:Y}=this;for(;Y.length;)Y.shift().error(F)}})}complete(){(0,W.Y)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:F}=this;for(;F.length;)F.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var F;return(null===(F=this.observers)||void 0===F?void 0:F.length)>0}_trySubscribe(F){return this._throwIfClosed(),super._trySubscribe(F)}_subscribe(F){return this._throwIfClosed(),this._checkFinalizedStatuses(F),this._innerSubscribe(F)}_innerSubscribe(F){const{hasError:Y,isStopped:Ke,observers:se}=this;return Y||Ke?G.Kn:(this.currentObservers=null,se.push(F),new G.yU(()=>{this.currentObservers=null,(0,q.o)(se,F)}))}_checkFinalizedStatuses(F){const{hasError:Y,thrownError:Ke,isStopped:se}=this;Y?F.error(Ke):se&&F.complete()}asObservable(){const F=new ie.c;return F.source=this,F}}return me.create=(z,F)=>new xe(z,F),me})();class xe extends Me{constructor(z,F){super(),this.destination=z,this.source=F}next(z){var F,Y;null===(Y=null===(F=this.destination)||void 0===F?void 0:F.next)||void 0===Y||Y.call(F,z)}error(z){var F,Y;null===(Y=null===(F=this.destination)||void 0===F?void 0:F.error)||void 0===Y||Y.call(F,z)}complete(){var z,F;null===(F=null===(z=this.destination)||void 0===z?void 0:z.complete)||void 0===F||F.call(z)}_subscribe(z){var F,Y;return null!==(Y=null===(F=this.source)||void 0===F?void 0:F.subscribe(z))&&void 0!==Y?Y:G.Kn}}},707:(J,oe,U)=>{"use strict";U.d(oe,{Ms:()=>_t,vU:()=>Y});var ie=U(71),G=U(359),ce=U(26),K=U(334),q=U(343);const W=me("C",void 0,void 0);function me(qe,X,ke){return{kind:qe,value:X,error:ke}}var z=U(270),F=U(786);class Y extends G.yU{constructor(X){super(),this.isStopped=!1,X?(this.destination=X,(0,G.Uv)(X)&&X.add(this)):this.destination=dn}static create(X,ke,Xe){return new _t(X,ke,Xe)}next(X){this.isStopped?Ct(function xe(qe){return me("N",qe,void 0)}(X),this):this._next(X)}error(X){this.isStopped?Ct(function Me(qe){return me("E",void 0,qe)}(X),this):(this.isStopped=!0,this._error(X))}complete(){this.isStopped?Ct(W,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(X){this.destination.next(X)}_error(X){try{this.destination.error(X)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Ke=Function.prototype.bind;function se(qe,X){return Ke.call(qe,X)}class Te{constructor(X){this.partialObserver=X}next(X){const{partialObserver:ke}=this;if(ke.next)try{ke.next(X)}catch(Xe){He(Xe)}}error(X){const{partialObserver:ke}=this;if(ke.error)try{ke.error(X)}catch(Xe){He(Xe)}else He(X)}complete(){const{partialObserver:X}=this;if(X.complete)try{X.complete()}catch(ke){He(ke)}}}class _t extends Y{constructor(X,ke,Xe){let fn;if(super(),(0,ie.T)(X)||!X)fn={next:X??void 0,error:ke??void 0,complete:Xe??void 0};else{let pt;this&&ce.$.useDeprecatedNextContext?(pt=Object.create(X),pt.unsubscribe=()=>this.unsubscribe(),fn={next:X.next&&se(X.next,pt),error:X.error&&se(X.error,pt),complete:X.complete&&se(X.complete,pt)}):fn=X}this.destination=new Te(fn)}}function He(qe){ce.$.useDeprecatedSynchronousErrorHandling?(0,F.l)(qe):(0,K.m)(qe)}function Ct(qe,X){const{onStoppedNotification:ke}=ce.$;ke&&z.f.setTimeout(()=>ke(qe,X))}const dn={closed:!0,next:q.l,error:function ht(qe){throw qe},complete:q.l}},359:(J,oe,U)=>{"use strict";U.d(oe,{Kn:()=>W,yU:()=>q,Uv:()=>Me});var ie=U(71);const ce=(0,U(853).L)(me=>function(F){me(this),this.message=F?`${F.length} errors occurred during unsubscription:\n${F.map((Y,Ke)=>`${Ke+1}) ${Y.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=F});var K=U(908);class q{constructor(z){this.initialTeardown=z,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let z;if(!this.closed){this.closed=!0;const{_parentage:F}=this;if(F)if(this._parentage=null,Array.isArray(F))for(const se of F)se.remove(this);else F.remove(this);const{initialTeardown:Y}=this;if((0,ie.T)(Y))try{Y()}catch(se){z=se instanceof ce?se.errors:[se]}const{_finalizers:Ke}=this;if(Ke){this._finalizers=null;for(const se of Ke)try{xe(se)}catch(Te){z=z??[],Te instanceof ce?z=[...z,...Te.errors]:z.push(Te)}}if(z)throw new ce(z)}}add(z){var F;if(z&&z!==this)if(this.closed)xe(z);else{if(z instanceof q){if(z.closed||z._hasParent(this))return;z._addParent(this)}(this._finalizers=null!==(F=this._finalizers)&&void 0!==F?F:[]).push(z)}}_hasParent(z){const{_parentage:F}=this;return F===z||Array.isArray(F)&&F.includes(z)}_addParent(z){const{_parentage:F}=this;this._parentage=Array.isArray(F)?(F.push(z),F):F?[F,z]:z}_removeParent(z){const{_parentage:F}=this;F===z?this._parentage=null:Array.isArray(F)&&(0,K.o)(F,z)}remove(z){const{_finalizers:F}=this;F&&(0,K.o)(F,z),z instanceof q&&z._removeParent(this)}}q.EMPTY=(()=>{const me=new q;return me.closed=!0,me})();const W=q.EMPTY;function Me(me){return me instanceof q||me&&"closed"in me&&(0,ie.T)(me.remove)&&(0,ie.T)(me.add)&&(0,ie.T)(me.unsubscribe)}function xe(me){(0,ie.T)(me)?me():me.unsubscribe()}},26:(J,oe,U)=>{"use strict";U.d(oe,{$:()=>ie});const ie={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},360:(J,oe,U)=>{"use strict";U.d(oe,{_:()=>G});var ie=U(707);function G(K,q,W,Me,xe){return new ce(K,q,W,Me,xe)}class ce extends ie.vU{constructor(q,W,Me,xe,me,z){super(q),this.onFinalize=me,this.shouldUnsubscribe=z,this._next=W?function(F){try{W(F)}catch(Y){q.error(Y)}}:super._next,this._error=xe?function(F){try{xe(F)}catch(Y){q.error(Y)}finally{this.unsubscribe()}}:super._error,this._complete=Me?function(){try{Me()}catch(F){q.error(F)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var q;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:W}=this;super.unsubscribe(),!W&&(null===(q=this.onFinalize)||void 0===q||q.call(this))}}}},354:(J,oe,U)=>{"use strict";U.d(oe,{T:()=>ce});var ie=U(974),G=U(360);function ce(K,q){return(0,ie.N)((W,Me)=>{let xe=0;W.subscribe((0,G._)(Me,me=>{Me.next(K.call(q,me,xe++))}))})}},270:(J,oe,U)=>{"use strict";U.d(oe,{f:()=>ie});const ie={setTimeout(G,ce,...K){const{delegate:q}=ie;return q?.setTimeout?q.setTimeout(G,ce,...K):setTimeout(G,ce,...K)},clearTimeout(G){const{delegate:ce}=ie;return(ce?.clearTimeout||clearTimeout)(G)},delegate:void 0}},494:(J,oe,U)=>{"use strict";U.d(oe,{s:()=>ie});const ie="function"==typeof Symbol&&Symbol.observable||"@@observable"},908:(J,oe,U)=>{"use strict";function ie(G,ce){if(G){const K=G.indexOf(ce);0<=K&&G.splice(K,1)}}U.d(oe,{o:()=>ie})},853:(J,oe,U)=>{"use strict";function ie(G){const K=G(q=>{Error.call(q),q.stack=(new Error).stack});return K.prototype=Object.create(Error.prototype),K.prototype.constructor=K,K}U.d(oe,{L:()=>ie})},786:(J,oe,U)=>{"use strict";U.d(oe,{Y:()=>ce,l:()=>K});var ie=U(26);let G=null;function ce(q){if(ie.$.useDeprecatedSynchronousErrorHandling){const W=!G;if(W&&(G={errorThrown:!1,error:null}),q(),W){const{errorThrown:Me,error:xe}=G;if(G=null,Me)throw xe}}else q()}function K(q){ie.$.useDeprecatedSynchronousErrorHandling&&G&&(G.errorThrown=!0,G.error=q)}},669:(J,oe,U)=>{"use strict";function ie(G){return G}U.d(oe,{D:()=>ie})},71:(J,oe,U)=>{"use strict";function ie(G){return"function"==typeof G}U.d(oe,{T:()=>ie})},974:(J,oe,U)=>{"use strict";U.d(oe,{N:()=>ce});var ie=U(71);function ce(K){return q=>{if(function G(K){return(0,ie.T)(K?.lift)}(q))return q.lift(function(W){try{return K(W,this)}catch(Me){this.error(Me)}});throw new TypeError("Unable to lift unknown Observable type")}}},343:(J,oe,U)=>{"use strict";function ie(){}U.d(oe,{l:()=>ie})},203:(J,oe,U)=>{"use strict";U.d(oe,{m:()=>ce});var ie=U(669);function ce(K){return 0===K.length?ie.D:1===K.length?K[0]:function(W){return K.reduce((Me,xe)=>xe(Me),W)}}},334:(J,oe,U)=>{"use strict";U.d(oe,{m:()=>ce});var ie=U(26),G=U(270);function ce(K){G.f.setTimeout(()=>{const{onUnhandledError:q}=ie.$;if(!q)throw K;q(K)})}},720:()=>{},194:()=>{},236:()=>{},676:()=>{},611:()=>{},449:()=>{},953:(J,oe,U)=>{"use strict";U.d(oe,{naY:()=>CA});let G=null;function W(e){const t=G;return G=e,t}U(412),U(413),U(359),U(354),typeof navigator<"u"&&navigator,typeof navigator<"u"&&!/Opera/.test(navigator.userAgent)&&navigator,typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||navigator),typeof navigator<"u"&&!/Opera|WebKit/.test(navigator.userAgent)&&navigator,typeof navigator<"u"&&navigator;class b extends Error{constructor(t,n){super(function Q(e,t){return`NG0${Math.abs(e)}${t?": "+t:""}`}(t,n)),this.code=t}}function Le(e){for(let t in e)if(e[t]===Le)return t;throw Error("Could not find renamed property on target object.")}function vt(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(vt).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}globalThis;const lI=Le({__forward_ref__:Le});function pl(e){return e.__forward_ref__=pl,e.toString=function(){return vt(this())},e}function de(e){return function Vs(e){return"function"==typeof e&&e.hasOwnProperty(lI)&&e.__forward_ref__===pl}(e)?e():e}function We(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function js(e){return eh(e,Hs)||eh(e,th)}function eh(e,t){return e.hasOwnProperty(t)?e[t]:null}function Us(e){return e&&(e.hasOwnProperty(ml)||e.hasOwnProperty(pI))?e[ml]:null}const Hs=Le({\u0275prov:Le}),ml=Le({\u0275inj:Le}),th=Le({ngInjectableDef:Le}),pI=Le({ngInjectorDef:Le});class ve{constructor(t,n){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=We({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function Il(e){return e&&!!e.\u0275providers}const ui=Le({\u0275cmp:Le}),$n=Le({\u0275fac:Le}),oh=Le({__NG_ENV_ID__:Le});var Ce=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(Ce||{});let Tl;function Ht(e){const t=Tl;return Tl=e,t}function sh(e,t,n){const r=js(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:n&Ce.Optional?null:void 0!==t?t:void function Dl(e,t){throw new b(-201,!1)}()}const fi={},bl="__NG_DI_FLAG__",$s="ngTempTokenPath",EI=/\n/gm,ah="__source";let qr;function ir(e){const t=qr;return qr=e,t}function CI(e,t=Ce.Default){if(void 0===qr)throw new b(-203,!1);return null===qr?sh(e,void 0,t):qr.get(e,t&Ce.Optional?null:void 0,t)}function Pt(e,t=Ce.Default){return(function ih(){return Tl}()||CI)(de(e),t)}function Sl(e){const t=[];for(let n=0;n<e.length;n++){const r=de(e[n]);if(Array.isArray(r)){if(0===r.length)throw new b(900,!1);let o,i=Ce.Default;for(let s=0;s<r.length;s++){const c=r[s],u=DI(c);"number"==typeof u?-1===u?o=c.token:i|=u:o=c}t.push(Pt(o,i))}else t.push(Pt(r))}return t}function DI(e){return e[bl]}function Er(e,t){return e.hasOwnProperty($n)?e[$n]:null}function Kr(e,t){e.forEach(n=>Array.isArray(n)?Kr(n,t):t(n))}const Se=[],Bn=new ve(""),fh=new ve("",-1),Pl=new ve("");class Gs{get(t,n=fi){if(n===fi){const r=new Error(`NullInjectorError: No provider for ${vt(t)}!`);throw r.name="NullInjectorError",r}return n}}function QI(...e){return{\u0275providers:Ol(0,e),\u0275fromNgModule:!0}}function Ol(e,...t){const n=[],r=new Set;let o;const i=s=>{n.push(s)};return Kr(t,s=>{const c=s;Qs(c,i,[],r)&&(o||=[],o.push(c))}),void 0!==o&&Ch(o,i),n}function Ch(e,t){for(let n=0;n<e.length;n++){const{ngModule:r,providers:o}=e[n];Ll(o,i=>{t(i,r)})}}function Qs(e,t,n,r){if(!(e=de(e)))return!1;let o=null,i=Us(e);const s=!i&&function ye(e){return e[ui]||null}(e);if(i||s){if(s&&!s.standalone)return!1;o=e}else{const u=e.ngModule;if(i=Us(u),!i)return!1;o=u}const c=r.has(o);if(s){if(c)return!1;if(r.add(o),s.dependencies){const u="function"==typeof s.dependencies?s.dependencies():s.dependencies;for(const d of u)Qs(d,t,n,r)}}else{if(!i)return!1;{if(null!=i.imports&&!c){let d;r.add(o);try{Kr(i.imports,h=>{Qs(h,t,n,r)&&(d||=[],d.push(h))})}finally{}void 0!==d&&Ch(d,t)}if(!c){const d=Er(o)||(()=>new o);t({provide:o,useFactory:d,deps:Se},o),t({provide:Pl,useValue:o,multi:!0},o),t({provide:Bn,useValue:()=>Pt(o),multi:!0},o)}const u=i.providers;if(null!=u&&!c){const d=e;Ll(u,h=>{t(h,d)})}}}return o!==e&&void 0!==e.providers}function Ll(e,t){for(let n of e)Il(n)&&(n=n.\u0275providers),Array.isArray(n)?Ll(n,t):t(n)}const YI=Le({provide:String,useValue:Le});function Fl(e){return null!==e&&"object"==typeof e&&YI in e}function Cr(e){return"function"==typeof e}const bh=new ve(""),Ys={},XI={};let Vl;function Js(){return void 0===Vl&&(Vl=new Gs),Vl}class vn{}class Yr extends vn{get destroyed(){return this._destroyed}constructor(t,n,r,o){super(),this.parent=n,this.source=r,this.scopes=o,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Ul(t,s=>this.processProvider(s)),this.records.set(fh,Jr(void 0,this)),o.has("environment")&&this.records.set(vn,Jr(void 0,this));const i=this.records.get(bh);null!=i&&"string"==typeof i.value&&this.scopes.add(i.value),this.injectorDefTypes=new Set(this.get(Pl,Se,Ce.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;const t=W(null);try{for(const r of this._ngOnDestroyHooks)r.ngOnDestroy();const n=this._onDestroyHooks;this._onDestroyHooks=[];for(const r of n)r()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),W(t)}}onDestroy(t){return this.assertNotDestroyed(),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){this.assertNotDestroyed();const n=ir(this),r=Ht(void 0);try{return t()}finally{ir(n),Ht(r)}}get(t,n=fi,r=Ce.Default){if(this.assertNotDestroyed(),t.hasOwnProperty(oh))return t[oh](this);r=function Bs(e){return typeof e>"u"||"number"==typeof e?e:(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}(r);const i=ir(this),s=Ht(void 0);try{if(!(r&Ce.SkipSelf)){let u=this.records.get(t);if(void 0===u){const d=function ow(e){return"function"==typeof e||"object"==typeof e&&e instanceof ve}(t)&&js(t);u=d&&this.injectableDefInScope(d)?Jr(jl(t),Ys):null,this.records.set(t,u)}if(null!=u)return this.hydrate(t,u)}return(r&Ce.Self?Js():this.parent).get(t,n=r&Ce.Optional&&n===fi?null:n)}catch(c){if("NullInjectorError"===c.name){if((c[$s]=c[$s]||[]).unshift(vt(t)),i)throw c;return function TI(e,t,n,r){const o=e[$s];throw t[ah]&&o.unshift(t[ah]),e.message=function bI(e,t,n,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let o=vt(t);if(Array.isArray(t))o=t.map(vt).join(" -> ");else if("object"==typeof t){let i=[];for(let s in t)if(t.hasOwnProperty(s)){let c=t[s];i.push(s+":"+("string"==typeof c?JSON.stringify(c):vt(c)))}o=`{${i.join(", ")}}`}return`${n}${r?"("+r+")":""}[${o}]: ${e.replace(EI,"\n  ")}`}("\n"+e.message,o,n,r),e.ngTokenPath=o,e[$s]=null,e}(c,t,"R3InjectorError",this.source)}throw c}finally{Ht(s),ir(i)}}resolveInjectorInitializers(){const t=W(null),n=ir(this),r=Ht(void 0);try{const i=this.get(Bn,Se,Ce.Self);for(const s of i)s()}finally{ir(n),Ht(r),W(t)}}toString(){const t=[],n=this.records;for(const r of n.keys())t.push(vt(r));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new b(205,!1)}processProvider(t){let n=Cr(t=de(t))?t:de(t&&t.provide);const r=function tw(e){return Fl(e)?Jr(void 0,e.useValue):Jr(function Sh(e,t,n){let r;if(Cr(e)){const o=de(e);return Er(o)||jl(o)}if(Fl(e))r=()=>de(e.useValue);else if(function Th(e){return!(!e||!e.useFactory)}(e))r=()=>e.useFactory(...Sl(e.deps||[]));else if(function Dh(e){return!(!e||!e.useExisting)}(e))r=()=>Pt(de(e.useExisting));else{const o=de(e&&(e.useClass||e.provide));if(!function nw(e){return!!e.deps}(e))return Er(o)||jl(o);r=()=>new o(...Sl(e.deps))}return r}(e),Ys)}(t);if(!Cr(t)&&!0===t.multi){let o=this.records.get(n);o||(o=Jr(void 0,Ys,!0),o.factory=()=>Sl(o.multi),this.records.set(n,o)),n=t,o.multi.push(t)}this.records.set(n,r)}hydrate(t,n){const r=W(null);try{return n.value===Ys&&(n.value=XI,n.value=n.factory()),"object"==typeof n.value&&n.value&&function rw(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(n.value)&&this._ngOnDestroyHooks.add(n.value),n.value}finally{W(r)}}injectableDefInScope(t){if(!t.providedIn)return!1;const n=de(t.providedIn);return"string"==typeof n?"any"===n||this.scopes.has(n):this.injectorDefTypes.has(n)}removeOnDestroy(t){const n=this._onDestroyHooks.indexOf(t);-1!==n&&this._onDestroyHooks.splice(n,1)}}function jl(e){const t=js(e),n=null!==t?t.factory:Er(e);if(null!==n)return n;if(e instanceof ve)throw new b(204,!1);if(e instanceof Function)return function ew(e){if(e.length>0)throw new b(204,!1);const n=function hI(e){return e&&(e[Hs]||e[th])||null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new b(204,!1)}function Jr(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function Ul(e,t){for(const n of e)Array.isArray(n)?Ul(n,t):n&&Il(n)?Ul(n.\u0275providers,t):t(n)}const he={lFrame:np(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function Fe(){let e=function Kh(){return he.lFrame.currentTNode}();for(;null!==e&&64===e.type;)e=e.parent;return e}function np(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function Dp(e,t=null,n=null,r){const o=function Tp(e,t=null,n=null,r,o=new Set){const i=[n||Se,QI(e)];return r=r||("object"==typeof e?void 0:vt(e)),new Yr(i,t||Js(),r||null,o)}(e,t,n,r);return o.resolveInjectorInitializers(),o}class wt{static{this.THROW_IF_NOT_FOUND=fi}static{this.NULL=new Gs}static create(t,n){if(Array.isArray(t))return Dp({name:""},n,t,"");{const r=t.name??"";return Dp({name:r},t.parent,t.providers,r)}}static{this.\u0275prov=We({token:wt,providedIn:"any",factory:()=>Pt(fh)})}static{this.__NG_ELEMENT_ID__=-1}}new ve("").__NG_ELEMENT_ID__=e=>{const t=Fe();if(null===t)throw new b(204,!1);if(2&t.type)return t.value;if(e&Ce.Optional)return null;throw new b(204,!1)};class Nb{resolveComponentFactory(t){throw function xb(e){const t=Error(`No component factory found for ${vt(e)}.`);return t.ngComponent=e,t}(t)}}class Qa{static{this.NULL=new Nb}}function CA(){return!1}},467:(J,oe,U)=>{"use strict";function ie(ce,K,q,W,Me,xe,me){try{var z=ce[xe](me),F=z.value}catch(Y){return void q(Y)}z.done?K(F):Promise.resolve(F).then(W,Me)}function G(ce){return function(){var K=this,q=arguments;return new Promise(function(W,Me){var xe=ce.apply(K,q);function me(F){ie(xe,W,Me,me,z,"next",F)}function z(F){ie(xe,W,Me,me,z,"throw",F)}me(void 0)})}}U.d(oe,{A:()=>G})}},Ff={};function Ft(J){var oe=Ff[J];if(void 0!==oe)return oe.exports;var U=Ff[J]={exports:{}};return aI[J](U,U.exports,Ft),U.exports}Ft.d=(J,oe)=>{for(var U in oe)Ft.o(oe,U)&&!Ft.o(J,U)&&Object.defineProperty(J,U,{enumerable:!0,get:oe[U]})},Ft.o=(J,oe)=>Object.prototype.hasOwnProperty.call(J,oe),(()=>{"use strict";var J=Ft(467),U=Ft(442);function G(p,a,l,f){l.push(a.length),a.push(...p);for(let g=p.length;g<f.coordLength;g++)a.push(0)}function ce(p,a,l,f){l.push(a.length);for(const g of p){a.push(...g);for(let m=g.length;m<f.coordLength;m++)a.push(0)}}function K(p,a,l,f,g){let m=0;const E=[],w=[];for(const x of p){const N=x.map(ne=>ne.slice(0,2));let b=(0,U.IC)(N.flat());const Q=b<0;g.fixRingWinding&&(0===m&&!Q||m>0&&Q)&&(x.reverse(),b=-b),E.push(b),ce(x,a,w,g),m++}m>0&&(f.push(E),l.push(w))}function W(p,a,l){const f=function xe(p){const a={};for(const l of p)if(l.properties)for(const f in l.properties)a[f]=ht(l.properties[f],a[f]);return a}(p),g=Object.keys(f).filter(m=>f[m]!==Array);return function me(p,a,l){const{pointPositionsCount:f,pointFeaturesCount:g,linePositionsCount:m,linePathsCount:E,lineFeaturesCount:w,polygonPositionsCount:x,polygonObjectsCount:N,polygonRingsCount:b,polygonFeaturesCount:Q,propArrayTypes:ne,coordLength:te}=a,{numericPropKeys:we=[],PositionDataType:Tt=Float32Array,triangulate:nr=!0}=l,Zt=p[0]&&"id"in p[0],Dn=p.length>65535?Uint32Array:Uint16Array,an={type:"Point",positions:new Tt(f*te),globalFeatureIds:new Dn(f),featureIds:g>65535?new Uint32Array(f):new Uint16Array(f),numericProps:{},properties:[],fields:[]},Qt={type:"LineString",pathIndices:m>65535?new Uint32Array(E+1):new Uint16Array(E+1),positions:new Tt(m*te),globalFeatureIds:new Dn(m),featureIds:w>65535?new Uint32Array(m):new Uint16Array(m),numericProps:{},properties:[],fields:[]},pn={type:"Polygon",polygonIndices:x>65535?new Uint32Array(N+1):new Uint16Array(N+1),primitivePolygonIndices:x>65535?new Uint32Array(b+1):new Uint16Array(b+1),positions:new Tt(x*te),globalFeatureIds:new Dn(x),featureIds:Q>65535?new Uint32Array(x):new Uint16Array(x),numericProps:{},properties:[],fields:[]};nr&&(pn.triangles=[]);for(const At of[an,Qt,pn])for(const rr of we)At.numericProps[rr]=new(0,ne[rr])(At.positions.length/te);Qt.pathIndices[E]=m,pn.polygonIndices[N]=x,pn.primitivePolygonIndices[b]=x;const gn={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(const At of p){const rr=At.geometry,Oe=At.properties||{};switch(rr.type){case"Point":z(rr,an,gn,te,Oe),an.properties.push(He(Oe,we)),Zt&&an.fields.push({id:At.id}),gn.pointFeature++;break;case"LineString":F(rr,Qt,gn,te,Oe),Qt.properties.push(He(Oe,we)),Zt&&Qt.fields.push({id:At.id}),gn.lineFeature++;break;case"Polygon":Y(rr,pn,gn,te,Oe),pn.properties.push(He(Oe,we)),Zt&&pn.fields.push({id:At.id}),gn.polygonFeature++;break;default:throw new Error("Invalid geometry type")}gn.feature++}return function Te(p,a,l,f){const g={points:{...p,positions:{value:p.positions,size:f},globalFeatureIds:{value:p.globalFeatureIds,size:1},featureIds:{value:p.featureIds,size:1},numericProps:se(p.numericProps,1)},lines:{...a,positions:{value:a.positions,size:f},pathIndices:{value:a.pathIndices,size:1},globalFeatureIds:{value:a.globalFeatureIds,size:1},featureIds:{value:a.featureIds,size:1},numericProps:se(a.numericProps,1)},polygons:{...l,positions:{value:l.positions,size:f},polygonIndices:{value:l.polygonIndices,size:1},primitivePolygonIndices:{value:l.primitivePolygonIndices,size:1},globalFeatureIds:{value:l.globalFeatureIds,size:1},featureIds:{value:l.featureIds,size:1},numericProps:se(l.numericProps,1)}};return l.triangles&&(g.polygons.triangles={value:new Uint32Array(l.triangles),size:1}),g}(an,Qt,pn,te)}(p,{propArrayTypes:f,...a},{numericPropKeys:l&&l.numericPropKeys||g,PositionDataType:l?l.PositionDataType:Float32Array,triangulate:!l||l.triangulate})}function z(p,a,l,f,g){a.positions.set(p.data,l.pointPosition*f);const m=p.data.length/f;_t(a,g,l.pointPosition,m),a.globalFeatureIds.fill(l.feature,l.pointPosition,l.pointPosition+m),a.featureIds.fill(l.pointFeature,l.pointPosition,l.pointPosition+m),l.pointPosition+=m}function F(p,a,l,f,g){a.positions.set(p.data,l.linePosition*f);const m=p.data.length/f;_t(a,g,l.linePosition,m),a.globalFeatureIds.fill(l.feature,l.linePosition,l.linePosition+m),a.featureIds.fill(l.lineFeature,l.linePosition,l.linePosition+m);for(let E=0,w=p.indices.length;E<w;++E){const x=p.indices[E],N=E===w-1?p.data.length:p.indices[E+1];a.pathIndices[l.linePath++]=l.linePosition,l.linePosition+=(N-x)/f}}function Y(p,a,l,f,g){a.positions.set(p.data,l.polygonPosition*f);const m=p.data.length/f;_t(a,g,l.polygonPosition,m),a.globalFeatureIds.fill(l.feature,l.polygonPosition,l.polygonPosition+m),a.featureIds.fill(l.polygonFeature,l.polygonPosition,l.polygonPosition+m);for(let E=0,w=p.indices.length;E<w;++E){const x=l.polygonPosition;a.polygonIndices[l.polygonObject++]=x;const N=p.areas[E],b=p.indices[E],Q=p.indices[E+1];for(let te=0,we=b.length;te<we;++te){const Tt=b[te],nr=te===we-1?void 0===Q?p.data.length:Q[0]:b[te+1];a.primitivePolygonIndices[l.polygonRing++]=l.polygonPosition,l.polygonPosition+=(nr-Tt)/f}Ke(a,N,b,{startPosition:x,endPosition:l.polygonPosition,coordLength:f})}}function Ke(p,a,l,f){let{startPosition:g,endPosition:m,coordLength:E}=f;if(!p.triangles)return;const N=p.positions.subarray(g*E,m*E),b=l[0],Q=l.slice(1).map(te=>(te-b)/E),ne=(0,U.hY)(N,Q,E,a);for(let te=0,we=ne.length;te<we;++te)p.triangles.push(g+ne[te])}function se(p,a){const l={};for(const f in p)l[f]={value:p[f],size:a};return l}function _t(p,a,l,f){for(const g in p.numericProps)g in a&&p.numericProps[g].fill(a[g],l,l+f)}function He(p,a){const l={};for(const f in p)a.includes(f)||(l[f]=p[f]);return l}function ht(p,a){return a!==Array&&Number.isFinite(p)?a===Float64Array||Math.fround(p)!==p?Float64Array:Float32Array:Array}function Ct(p){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fixRingWinding:!0,triangulate:!0};const l=function oe(p){let a=0,l=0,f=0,g=0,m=0,E=0,w=0,x=0,N=0;const b=new Set;for(const Q of p){const ne=Q.geometry;switch(ne.type){case"Point":l++,a++,b.add(ne.coordinates.length);break;case"MultiPoint":l++,a+=ne.coordinates.length;for(const we of ne.coordinates)b.add(we.length);break;case"LineString":m++,f+=ne.coordinates.length,g++;for(const we of ne.coordinates)b.add(we.length);break;case"MultiLineString":m++;for(const we of ne.coordinates){f+=we.length,g++;for(const Tt of we)b.add(Tt.length)}break;case"Polygon":N++,w++,x+=ne.coordinates.length;const te=ne.coordinates.flat();E+=te.length;for(const we of te)b.add(we.length);break;case"MultiPolygon":N++;for(const we of ne.coordinates){w++,x+=we.length;const Tt=we.flat();E+=Tt.length;for(const nr of Tt)b.add(nr.length)}break;default:throw new Error("Unsupported geometry type: ".concat(ne.type))}}return{coordLength:b.size>0?Math.max(...b):2,pointPositionsCount:a,pointFeaturesCount:l,linePositionsCount:f,linePathsCount:g,lineFeaturesCount:m,polygonPositionsCount:E,polygonObjectsCount:w,polygonRingsCount:x,polygonFeaturesCount:N}}(p),f=l.coordLength,{fixRingWinding:g}=a;return W(function ie(p){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{coordLength:2,fixRingWinding:!0};return p.map(l=>function q(p,a){const{geometry:l}=p;if("GeometryCollection"===l.type)throw new Error("GeometryCollection type not supported");const f=[],g=[];let m,E;switch(l.type){case"Point":E="Point",G(l.coordinates,f,g,a);break;case"MultiPoint":E="Point",l.coordinates.map(w=>G(w,f,g,a));break;case"LineString":E="LineString",ce(l.coordinates,f,g,a);break;case"MultiLineString":E="LineString",l.coordinates.map(w=>ce(w,f,g,a));break;case"Polygon":E="Polygon",m=[],K(l.coordinates,f,g,m,a);break;case"MultiPolygon":E="Polygon",m=[],l.coordinates.map(w=>K(w,f,g,m,a));break;default:throw new Error("Unknown type: ".concat(E))}return{...p,geometry:{type:E,indices:g,data:f,areas:m}}}(l,a))}(p,{coordLength:f,fixRingWinding:g}),l,{numericPropKeys:a.numericPropKeys,PositionDataType:a.PositionDataType||Float32Array,triangulate:a.triangulate})}const dn=[0,2e3,1e4,3e4,null];class qe{constructor(a){this._retryDelays=void 0!==a?[...a,null]:dn}nextRetryDelayInMilliseconds(a){return this._retryDelays[a.previousRetryCount]}}let X=(()=>{class p{}return p.Authorization="Authorization",p.Cookie="Cookie",p})();class ke{constructor(a,l,f){this.statusCode=a,this.statusText=l,this.content=f}}class Xe{get(a,l){return this.send({...l,method:"GET",url:a})}post(a,l){return this.send({...l,method:"POST",url:a})}delete(a,l){return this.send({...l,method:"DELETE",url:a})}getCookieString(a){return""}}class fn extends Xe{constructor(a,l){super(),this._innerClient=a,this._accessTokenFactory=l}send(a){var l=this;return(0,J.A)(function*(){let f=!0;l._accessTokenFactory&&(!l._accessToken||a.url&&a.url.indexOf("/negotiate?")>0)&&(f=!1,l._accessToken=yield l._accessTokenFactory()),l._setAuthorizationHeader(a);const g=yield l._innerClient.send(a);return f&&401===g.statusCode&&l._accessTokenFactory?(l._accessToken=yield l._accessTokenFactory(),l._setAuthorizationHeader(a),yield l._innerClient.send(a)):g})()}_setAuthorizationHeader(a){a.headers||(a.headers={}),this._accessToken?a.headers[X.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&a.headers[X.Authorization]&&delete a.headers[X.Authorization]}getCookieString(a){return this._innerClient.getCookieString(a)}}class pt extends Error{constructor(a,l){const f=new.target.prototype;super(`${a}: Status code '${l}'`),this.statusCode=l,this.__proto__=f}}class Yn extends Error{constructor(a="A timeout occurred."){const l=new.target.prototype;super(a),this.__proto__=l}}class Vt extends Error{constructor(a="An abort occurred."){const l=new.target.prototype;super(a),this.__proto__=l}}class Vn extends Error{constructor(a,l){const f=new.target.prototype;super(a),this.transport=l,this.errorType="UnsupportedTransportError",this.__proto__=f}}class Zo extends Error{constructor(a,l){const f=new.target.prototype;super(a),this.transport=l,this.errorType="DisabledTransportError",this.__proto__=f}}class je extends Error{constructor(a,l){const f=new.target.prototype;super(a),this.transport=l,this.errorType="FailedToStartTransportError",this.__proto__=f}}class Jn extends Error{constructor(a){const l=new.target.prototype;super(a),this.errorType="FailedToNegotiateWithServerError",this.__proto__=l}}class hr extends Error{constructor(a,l){const f=new.target.prototype;super(a),this.innerErrors=l,this.__proto__=f}}var R=function(p){return p[p.Trace=0]="Trace",p[p.Debug=1]="Debug",p[p.Information=2]="Information",p[p.Warning=3]="Warning",p[p.Error=4]="Error",p[p.Critical=5]="Critical",p[p.None=6]="None",p}(R||{});class rn{constructor(){}log(a,l){}}rn.instance=new rn;const pr="8.0.0";class Ue{static isRequired(a,l){if(null==a)throw new Error(`The '${l}' argument is required.`)}static isNotEmpty(a,l){if(!a||a.match(/^\s*$/))throw new Error(`The '${l}' argument should not be empty.`)}static isIn(a,l,f){if(!(a in l))throw new Error(`Unknown ${f} value: ${a}.`)}}class $e{static get isBrowser(){return!$e.isNode&&"object"==typeof window&&"object"==typeof window.document}static get isWebWorker(){return!$e.isNode&&"object"==typeof self&&"importScripts"in self}static get isReactNative(){return!$e.isNode&&"object"==typeof window&&typeof window.document>"u"}static get isNode(){return typeof process<"u"&&process.release&&"node"===process.release.name}}function jn(p,a){let l="";return jt(p)?(l=`Binary data of length ${p.byteLength}`,a&&(l+=`. Content: '${function Ur(p){const a=new Uint8Array(p);let l="";return a.forEach(f=>{l+=`0x${f<16?"0":""}${f.toString(16)} `}),l.substr(0,l.length-1)}(p)}'`)):"string"==typeof p&&(l=`String data of length ${p.length}`,a&&(l+=`. Content: '${p}'`)),l}function jt(p){return p&&typeof ArrayBuffer<"u"&&(p instanceof ArrayBuffer||p.constructor&&"ArrayBuffer"===p.constructor.name)}function Xn(p,a,l,f,g,m){return y.apply(this,arguments)}function y(){return(y=(0,J.A)(function*(p,a,l,f,g,m){const E={},[w,x]=M();E[w]=x,p.log(R.Trace,`(${a} transport) sending data. ${jn(g,m.logMessageContent)}.`);const N=jt(g)?"arraybuffer":"text",b=yield l.post(f,{content:g,headers:{...E,...m.headers},responseType:N,timeout:m.timeout,withCredentials:m.withCredentials});p.log(R.Trace,`(${a} transport) request complete. Response status: ${b.statusCode}.`)})).apply(this,arguments)}class C{constructor(a,l){this._subject=a,this._observer=l}dispose(){const a=this._subject.observers.indexOf(this._observer);a>-1&&this._subject.observers.splice(a,1),0===this._subject.observers.length&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(l=>{})}}class k{constructor(a){this._minLevel=a,this.out=console}log(a,l){if(a>=this._minLevel){const f=`[${(new Date).toISOString()}] ${R[a]}: ${l}`;switch(a){case R.Critical:case R.Error:this.out.error(f);break;case R.Warning:this.out.warn(f);break;case R.Information:this.out.info(f);break;default:this.out.log(f)}}}}function M(){let p="X-SignalR-User-Agent";return $e.isNode&&(p="User-Agent"),[p,L(pr,P(),$e.isNode?"NodeJS":"Browser",$())]}function L(p,a,l,f){let g="Microsoft SignalR/";const m=p.split(".");return g+=`${m[0]}.${m[1]}`,g+=` (${p}; `,g+=a&&""!==a?`${a}; `:"Unknown OS; ",g+=`${l}`,g+=f?`; ${f}`:"; Unknown Runtime Version",g+=")",g}function P(){if(!$e.isNode)return"";switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}}function $(){if($e.isNode)return process.versions.node}function Ie(p){return p.stack?p.stack:p.message?p.message:`${p}`}class er extends Xe{constructor(a){super(),this._logger=a;const l={_fetchType:void 0,_jar:void 0};!function gt(p){return!!(typeof fetch>"u"||$e.isNode)&&(p._jar=new(Ft(611).CookieJar),p._fetchType=typeof fetch>"u"?Ft(676):fetch,p._fetchType=Ft(236)(p._fetchType,p._jar),!0)}(l)?this._fetchType=fetch.bind(function De(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("could not find global")}()):(this._fetchType=l._fetchType,this._jar=l._jar),this._abortControllerType=AbortController;const f={_abortControllerType:this._abortControllerType};(function Dt(p){return typeof AbortController>"u"&&(p._abortControllerType=Ft(720),!0)})(f)&&(this._abortControllerType=f._abortControllerType)}send(a){var l=this;return(0,J.A)(function*(){if(a.abortSignal&&a.abortSignal.aborted)throw new Vt;if(!a.method)throw new Error("No method defined.");if(!a.url)throw new Error("No url defined.");const f=new l._abortControllerType;let g;a.abortSignal&&(a.abortSignal.onabort=()=>{f.abort(),g=new Vt});let E,m=null;a.timeout&&(m=setTimeout(()=>{f.abort(),l._logger.log(R.Warning,"Timeout from HTTP request."),g=new Yn},a.timeout)),""===a.content&&(a.content=void 0),a.content&&(a.headers=a.headers||{},a.headers["Content-Type"]=jt(a.content)?"application/octet-stream":"text/plain;charset=UTF-8");try{E=yield l._fetchType(a.url,{body:a.content,cache:"no-cache",credentials:!0===a.withCredentials?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...a.headers},method:a.method,mode:"cors",redirect:"follow",signal:f.signal})}catch(N){throw g||(l._logger.log(R.Warning,`Error from HTTP request. ${N}.`),N)}finally{m&&clearTimeout(m),a.abortSignal&&(a.abortSignal.onabort=null)}if(!E.ok){const N=yield Cs(E,"text");throw new pt(N||E.statusText,E.status)}const x=yield Cs(E,a.responseType);return new ke(E.status,E.statusText,x)})()}getCookieString(a){let l="";return $e.isNode&&this._jar&&this._jar.getCookies(a,(f,g)=>l=g.join("; ")),l}}function Cs(p,a){let l;switch(a){case"arraybuffer":l=p.arrayBuffer();break;case"text":default:l=p.text();break;case"blob":case"document":case"json":throw new Error(`${a} is not supported.`)}return l}class Z extends Xe{constructor(a){super(),this._logger=a}send(a){return a.abortSignal&&a.abortSignal.aborted?Promise.reject(new Vt):a.method?a.url?new Promise((l,f)=>{const g=new XMLHttpRequest;g.open(a.method,a.url,!0),g.withCredentials=void 0===a.withCredentials||a.withCredentials,g.setRequestHeader("X-Requested-With","XMLHttpRequest"),""===a.content&&(a.content=void 0),a.content&&(jt(a.content)?g.setRequestHeader("Content-Type","application/octet-stream"):g.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));const m=a.headers;m&&Object.keys(m).forEach(E=>{g.setRequestHeader(E,m[E])}),a.responseType&&(g.responseType=a.responseType),a.abortSignal&&(a.abortSignal.onabort=()=>{g.abort(),f(new Vt)}),a.timeout&&(g.timeout=a.timeout),g.onload=()=>{a.abortSignal&&(a.abortSignal.onabort=null),g.status>=200&&g.status<300?l(new ke(g.status,g.statusText,g.response||g.responseText)):f(new pt(g.response||g.responseText||g.statusText,g.status))},g.onerror=()=>{this._logger.log(R.Warning,`Error from HTTP request. ${g.status}: ${g.statusText}.`),f(new pt(g.statusText,g.status))},g.ontimeout=()=>{this._logger.log(R.Warning,"Timeout from HTTP request."),f(new Yn)},g.send(a.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class Vf extends Xe{constructor(a){if(super(),typeof fetch<"u"||$e.isNode)this._httpClient=new er(a);else{if(!(typeof XMLHttpRequest<"u"))throw new Error("No usable HttpClient found.");this._httpClient=new Z(a)}}send(a){return a.abortSignal&&a.abortSignal.aborted?Promise.reject(new Vt):a.method?a.url?this._httpClient.send(a):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(a){return this._httpClient.getCookieString(a)}}var st=function(p){return p[p.None=0]="None",p[p.WebSockets=1]="WebSockets",p[p.ServerSentEvents=2]="ServerSentEvents",p[p.LongPolling=4]="LongPolling",p}(st||{}),mt=function(p){return p[p.Text=1]="Text",p[p.Binary=2]="Binary",p}(mt||{});class Mc{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}}class Ds{get pollAborted(){return this._pollAbort.aborted}constructor(a,l,f){this._httpClient=a,this._logger=l,this._pollAbort=new Mc,this._options=f,this._running=!1,this.onreceive=null,this.onclose=null}connect(a,l){var f=this;return(0,J.A)(function*(){if(Ue.isRequired(a,"url"),Ue.isRequired(l,"transferFormat"),Ue.isIn(l,mt,"transferFormat"),f._url=a,f._logger.log(R.Trace,"(LongPolling transport) Connecting."),l===mt.Binary&&typeof XMLHttpRequest<"u"&&"string"!=typeof(new XMLHttpRequest).responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[g,m]=M(),E={[g]:m,...f._options.headers},w={abortSignal:f._pollAbort.signal,headers:E,timeout:1e5,withCredentials:f._options.withCredentials};l===mt.Binary&&(w.responseType="arraybuffer");const x=`${a}&_=${Date.now()}`;f._logger.log(R.Trace,`(LongPolling transport) polling: ${x}.`);const N=yield f._httpClient.get(x,w);200!==N.statusCode?(f._logger.log(R.Error,`(LongPolling transport) Unexpected response code: ${N.statusCode}.`),f._closeError=new pt(N.statusText||"",N.statusCode),f._running=!1):f._running=!0,f._receiving=f._poll(f._url,w)})()}_poll(a,l){var f=this;return(0,J.A)(function*(){try{for(;f._running;)try{const g=`${a}&_=${Date.now()}`;f._logger.log(R.Trace,`(LongPolling transport) polling: ${g}.`);const m=yield f._httpClient.get(g,l);204===m.statusCode?(f._logger.log(R.Information,"(LongPolling transport) Poll terminated by server."),f._running=!1):200!==m.statusCode?(f._logger.log(R.Error,`(LongPolling transport) Unexpected response code: ${m.statusCode}.`),f._closeError=new pt(m.statusText||"",m.statusCode),f._running=!1):m.content?(f._logger.log(R.Trace,`(LongPolling transport) data received. ${jn(m.content,f._options.logMessageContent)}.`),f.onreceive&&f.onreceive(m.content)):f._logger.log(R.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(g){f._running?g instanceof Yn?f._logger.log(R.Trace,"(LongPolling transport) Poll timed out, reissuing."):(f._closeError=g,f._running=!1):f._logger.log(R.Trace,`(LongPolling transport) Poll errored after shutdown: ${g.message}`)}}finally{f._logger.log(R.Trace,"(LongPolling transport) Polling complete."),f.pollAborted||f._raiseOnClose()}})()}send(a){var l=this;return(0,J.A)(function*(){return l._running?Xn(l._logger,"LongPolling",l._httpClient,l._url,a,l._options):Promise.reject(new Error("Cannot send until the transport is connected"))})()}stop(){var a=this;return(0,J.A)(function*(){a._logger.log(R.Trace,"(LongPolling transport) Stopping polling."),a._running=!1,a._pollAbort.abort();try{yield a._receiving,a._logger.log(R.Trace,`(LongPolling transport) sending DELETE request to ${a._url}.`);const l={},[f,g]=M();l[f]=g;const m={headers:{...l,...a._options.headers},timeout:a._options.timeout,withCredentials:a._options.withCredentials};let E;try{yield a._httpClient.delete(a._url,m)}catch(w){E=w}E?E instanceof pt&&a._logger.log(R.Trace,404===E.statusCode?"(LongPolling transport) A 404 response was returned from sending a DELETE request.":`(LongPolling transport) Error sending a DELETE request: ${E}`):a._logger.log(R.Trace,"(LongPolling transport) DELETE request accepted.")}finally{a._logger.log(R.Trace,"(LongPolling transport) Stop finished."),a._raiseOnClose()}})()}_raiseOnClose(){if(this.onclose){let a="(LongPolling transport) Firing onclose event.";this._closeError&&(a+=" Error: "+this._closeError),this._logger.log(R.Trace,a),this.onclose(this._closeError)}}}class gr{constructor(a,l,f,g){this._httpClient=a,this._accessToken=l,this._logger=f,this._options=g,this.onreceive=null,this.onclose=null}connect(a,l){var f=this;return(0,J.A)(function*(){return Ue.isRequired(a,"url"),Ue.isRequired(l,"transferFormat"),Ue.isIn(l,mt,"transferFormat"),f._logger.log(R.Trace,"(SSE transport) Connecting."),f._url=a,f._accessToken&&(a+=(a.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(f._accessToken)}`),new Promise((g,m)=>{let w,E=!1;if(l===mt.Text){if($e.isBrowser||$e.isWebWorker)w=new f._options.EventSource(a,{withCredentials:f._options.withCredentials});else{const x=f._httpClient.getCookieString(a),N={};N.Cookie=x;const[b,Q]=M();N[b]=Q,w=new f._options.EventSource(a,{withCredentials:f._options.withCredentials,headers:{...N,...f._options.headers}})}try{w.onmessage=x=>{if(f.onreceive)try{f._logger.log(R.Trace,`(SSE transport) data received. ${jn(x.data,f._options.logMessageContent)}.`),f.onreceive(x.data)}catch(N){return void f._close(N)}},w.onerror=x=>{E?f._close():m(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},w.onopen=()=>{f._logger.log(R.Information,`SSE connected to ${f._url}`),f._eventSource=w,E=!0,g()}}catch(x){return void m(x)}}else m(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))})})()}send(a){var l=this;return(0,J.A)(function*(){return l._eventSource?Xn(l._logger,"SSE",l._httpClient,l._url,a,l._options):Promise.reject(new Error("Cannot send until the transport is connected"))})()}stop(){return this._close(),Promise.resolve()}_close(a){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(a))}}class xc{constructor(a,l,f,g,m,E){this._logger=f,this._accessTokenFactory=l,this._logMessageContent=g,this._webSocketConstructor=m,this._httpClient=a,this.onreceive=null,this.onclose=null,this._headers=E}connect(a,l){var f=this;return(0,J.A)(function*(){let g;return Ue.isRequired(a,"url"),Ue.isRequired(l,"transferFormat"),Ue.isIn(l,mt,"transferFormat"),f._logger.log(R.Trace,"(WebSockets transport) Connecting."),f._accessTokenFactory&&(g=yield f._accessTokenFactory()),new Promise((m,E)=>{let w;a=a.replace(/^http/,"ws");const x=f._httpClient.getCookieString(a);let N=!1;if($e.isNode||$e.isReactNative){const b={},[Q,ne]=M();b[Q]=ne,g&&(b[X.Authorization]=`Bearer ${g}`),x&&(b[X.Cookie]=x),w=new f._webSocketConstructor(a,void 0,{headers:{...b,...f._headers}})}else g&&(a+=(a.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(g)}`);w||(w=new f._webSocketConstructor(a)),l===mt.Binary&&(w.binaryType="arraybuffer"),w.onopen=b=>{f._logger.log(R.Information,`WebSocket connected to ${a}.`),f._webSocket=w,N=!0,m()},w.onerror=b=>{let Q=null;Q=typeof ErrorEvent<"u"&&b instanceof ErrorEvent?b.error:"There was an error with the transport",f._logger.log(R.Information,`(WebSockets transport) ${Q}.`)},w.onmessage=b=>{if(f._logger.log(R.Trace,`(WebSockets transport) data received. ${jn(b.data,f._logMessageContent)}.`),f.onreceive)try{f.onreceive(b.data)}catch(Q){return void f._close(Q)}},w.onclose=b=>{if(N)f._close(b);else{let Q=null;Q=typeof ErrorEvent<"u"&&b instanceof ErrorEvent?b.error:"WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",E(new Error(Q))}}})})()}send(a){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(R.Trace,`(WebSockets transport) sending data. ${jn(a,this._logMessageContent)}.`),this._webSocket.send(a),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(a){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(R.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!this._isCloseEvent(a)||!1!==a.wasClean&&1e3===a.code?a instanceof Error?this.onclose(a):this.onclose():this.onclose(new Error(`WebSocket closed with status code: ${a.code} (${a.reason||"no reason given"}).`)))}_isCloseEvent(a){return a&&"boolean"==typeof a.wasClean&&"number"==typeof a.code}}class jf{constructor(a,l={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,Ue.isRequired(a,"url"),this._logger=function D(p){return void 0===p?new k(R.Information):null===p?rn.instance:void 0!==p.log?p:new k(p)}(l.logger),this.baseUrl=this._resolveUrl(a),(l=l||{}).logMessageContent=void 0!==l.logMessageContent&&l.logMessageContent,"boolean"!=typeof l.withCredentials&&void 0!==l.withCredentials)throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");l.withCredentials=void 0===l.withCredentials||l.withCredentials,l.timeout=void 0===l.timeout?1e5:l.timeout;let f=null,g=null;$e.isNode&&(f=function Ne(){return Ft(449)}(),g=function Ae(){return Ft(194)}()),!$e.isNode&&typeof WebSocket<"u"&&!l.WebSocket?l.WebSocket=WebSocket:$e.isNode&&!l.WebSocket&&f&&(l.WebSocket=f),!$e.isNode&&typeof EventSource<"u"&&!l.EventSource?l.EventSource=EventSource:$e.isNode&&!l.EventSource&&typeof g<"u"&&(l.EventSource=g),this._httpClient=new fn(l.httpClient||new Vf(this._logger),l.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=l,this.onreceive=null,this.onclose=null}start(a){var l=this;return(0,J.A)(function*(){if(Ue.isIn(a=a||mt.Binary,mt,"transferFormat"),l._logger.log(R.Debug,`Starting connection with transfer format '${mt[a]}'.`),"Disconnected"!==l._connectionState)return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(l._connectionState="Connecting",l._startInternalPromise=l._startInternal(a),yield l._startInternalPromise,"Disconnecting"===l._connectionState){const f="Failed to start the HttpConnection before stop() was called.";return l._logger.log(R.Error,f),yield l._stopPromise,Promise.reject(new Vt(f))}if("Connected"!==l._connectionState){const f="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return l._logger.log(R.Error,f),Promise.reject(new Vt(f))}l._connectionStarted=!0})()}send(a){return"Connected"!==this._connectionState?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new Yo(this.transport)),this._sendQueue.send(a))}stop(a){var l=this;return(0,J.A)(function*(){return"Disconnected"===l._connectionState?(l._logger.log(R.Debug,`Call to HttpConnection.stop(${a}) ignored because the connection is already in the disconnected state.`),Promise.resolve()):"Disconnecting"===l._connectionState?(l._logger.log(R.Debug,`Call to HttpConnection.stop(${a}) ignored because the connection is already in the disconnecting state.`),l._stopPromise):(l._connectionState="Disconnecting",l._stopPromise=new Promise(f=>{l._stopPromiseResolver=f}),yield l._stopInternal(a),void(yield l._stopPromise))})()}_stopInternal(a){var l=this;return(0,J.A)(function*(){l._stopError=a;try{yield l._startInternalPromise}catch{}if(l.transport){try{yield l.transport.stop()}catch(f){l._logger.log(R.Error,`HttpConnection.transport.stop() threw error '${f}'.`),l._stopConnection()}l.transport=void 0}else l._logger.log(R.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")})()}_startInternal(a){var l=this;return(0,J.A)(function*(){let f=l.baseUrl;l._accessTokenFactory=l._options.accessTokenFactory,l._httpClient._accessTokenFactory=l._accessTokenFactory;try{if(l._options.skipNegotiation){if(l._options.transport!==st.WebSockets)throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");l.transport=l._constructTransport(st.WebSockets),yield l._startTransport(f,a)}else{let g=null,m=0;do{if(g=yield l._getNegotiationResponse(f),"Disconnecting"===l._connectionState||"Disconnected"===l._connectionState)throw new Vt("The connection was stopped during negotiation.");if(g.error)throw new Error(g.error);if(g.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(g.url&&(f=g.url),g.accessToken){const E=g.accessToken;l._accessTokenFactory=()=>E,l._httpClient._accessToken=E,l._httpClient._accessTokenFactory=void 0}m++}while(g.url&&m<100);if(100===m&&g.url)throw new Error("Negotiate redirection limit exceeded.");yield l._createTransport(f,l._options.transport,g,a)}l.transport instanceof Ds&&(l.features.inherentKeepAlive=!0),"Connecting"===l._connectionState&&(l._logger.log(R.Debug,"The HttpConnection connected successfully."),l._connectionState="Connected")}catch(g){return l._logger.log(R.Error,"Failed to start the connection: "+g),l._connectionState="Disconnected",l.transport=void 0,l._stopPromiseResolver(),Promise.reject(g)}})()}_getNegotiationResponse(a){var l=this;return(0,J.A)(function*(){const f={},[g,m]=M();f[g]=m;const E=l._resolveNegotiateUrl(a);l._logger.log(R.Debug,`Sending negotiation request: ${E}.`);try{const w=yield l._httpClient.post(E,{content:"",headers:{...f,...l._options.headers},timeout:l._options.timeout,withCredentials:l._options.withCredentials});if(200!==w.statusCode)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${w.statusCode}'`));const x=JSON.parse(w.content);return(!x.negotiateVersion||x.negotiateVersion<1)&&(x.connectionToken=x.connectionId),x.useStatefulReconnect&&!0!==l._options._useStatefulReconnect?Promise.reject(new Jn("Client didn't negotiate Stateful Reconnect but the server did.")):x}catch(w){let x="Failed to complete negotiation with the server: "+w;return w instanceof pt&&404===w.statusCode&&(x+=" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),l._logger.log(R.Error,x),Promise.reject(new Jn(x))}})()}_createConnectUrl(a,l){return l?a+(-1===a.indexOf("?")?"?":"&")+`id=${l}`:a}_createTransport(a,l,f,g){var m=this;return(0,J.A)(function*(){let E=m._createConnectUrl(a,f.connectionToken);if(m._isITransport(l))return m._logger.log(R.Debug,"Connection was provided an instance of ITransport, using that directly."),m.transport=l,yield m._startTransport(E,g),void(m.connectionId=f.connectionId);const w=[],x=f.availableTransports||[];let N=f;for(const b of x){const Q=m._resolveTransportOrError(b,l,g,!0===N?.useStatefulReconnect);if(Q instanceof Error)w.push(`${b.transport} failed:`),w.push(Q);else if(m._isITransport(Q)){if(m.transport=Q,!N){try{N=yield m._getNegotiationResponse(a)}catch(ne){return Promise.reject(ne)}E=m._createConnectUrl(a,N.connectionToken)}try{return yield m._startTransport(E,g),void(m.connectionId=N.connectionId)}catch(ne){if(m._logger.log(R.Error,`Failed to start the transport '${b.transport}': ${ne}`),N=void 0,w.push(new je(`${b.transport} failed: ${ne}`,st[b.transport])),"Connecting"!==m._connectionState){const te="Failed to select transport before stop() was called.";return m._logger.log(R.Debug,te),Promise.reject(new Vt(te))}}}}return Promise.reject(w.length>0?new hr(`Unable to connect to the server with any of the available transports. ${w.join(" ")}`,w):new Error("None of the transports supported by the client are supported by the server."))})()}_constructTransport(a){switch(a){case st.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new xc(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case st.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new gr(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case st.LongPolling:return new Ds(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${a}.`)}}_startTransport(a,l){var f=this;return this.transport.onreceive=this.onreceive,this.transport.onclose=this.features.reconnect?function(){var g=(0,J.A)(function*(m){let E=!1;if(f.features.reconnect){try{f.features.disconnected(),yield f.transport.connect(a,l),yield f.features.resend()}catch{E=!0}E&&f._stopConnection(m)}else f._stopConnection(m)});return function(m){return g.apply(this,arguments)}}():g=>this._stopConnection(g),this.transport.connect(a,l)}_resolveTransportOrError(a,l,f,g){const m=st[a.transport];if(null==m)return this._logger.log(R.Debug,`Skipping transport '${a.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${a.transport}' because it is not supported by this client.`);if(!function Ts(p,a){return!p||!!(a&p)}(l,m))return this._logger.log(R.Debug,`Skipping transport '${st[m]}' because it was disabled by the client.`),new Zo(`'${st[m]}' is disabled by the client.`,m);if(!(a.transferFormats.map(w=>mt[w]).indexOf(f)>=0))return this._logger.log(R.Debug,`Skipping transport '${st[m]}' because it does not support the requested transfer format '${mt[f]}'.`),new Error(`'${st[m]}' does not support ${mt[f]}.`);if(m===st.WebSockets&&!this._options.WebSocket||m===st.ServerSentEvents&&!this._options.EventSource)return this._logger.log(R.Debug,`Skipping transport '${st[m]}' because it is not supported in your environment.'`),new Vn(`'${st[m]}' is not supported in your environment.`,m);this._logger.log(R.Debug,`Selecting transport '${st[m]}'.`);try{return this.features.reconnect=m===st.WebSockets?g:void 0,this._constructTransport(m)}catch(w){return w}}_isITransport(a){return a&&"object"==typeof a&&"connect"in a}_stopConnection(a){if(this._logger.log(R.Debug,`HttpConnection.stopConnection(${a}) called while in state ${this._connectionState}.`),this.transport=void 0,a=this._stopError||a,this._stopError=void 0,"Disconnected"!==this._connectionState){if("Connecting"===this._connectionState)throw this._logger.log(R.Warning,`Call to HttpConnection.stopConnection(${a}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${a}) was called while the connection is still in the connecting state.`);if("Disconnecting"===this._connectionState&&this._stopPromiseResolver(),a?this._logger.log(R.Error,`Connection disconnected with error '${a}'.`):this._logger.log(R.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(l=>{this._logger.log(R.Error,`TransportSendQueue.stop() threw error '${l}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(a)}catch(l){this._logger.log(R.Error,`HttpConnection.onclose(${a}) threw error '${l}'.`)}}}else this._logger.log(R.Debug,`Call to HttpConnection.stopConnection(${a}) was ignored because the connection is already in the disconnected state.`)}_resolveUrl(a){if(0===a.lastIndexOf("https://",0)||0===a.lastIndexOf("http://",0))return a;if(!$e.isBrowser)throw new Error(`Cannot resolve '${a}'.`);const l=window.document.createElement("a");return l.href=a,this._logger.log(R.Information,`Normalizing '${a}' to '${l.href}'.`),l.href}_resolveNegotiateUrl(a){const l=new URL(a);l.pathname.endsWith("/")?l.pathname+="negotiate":l.pathname+="/negotiate";const f=new URLSearchParams(l.searchParams);return f.has("negotiateVersion")||f.append("negotiateVersion",this._negotiateVersion.toString()),f.has("useStatefulReconnect")?"true"===f.get("useStatefulReconnect")&&(this._options._useStatefulReconnect=!0):!0===this._options._useStatefulReconnect&&f.append("useStatefulReconnect","true"),l.search=f.toString(),l.toString()}}class Yo{constructor(a){this._transport=a,this._buffer=[],this._executing=!0,this._sendBufferedData=new mr,this._transportResult=new mr,this._sendLoopPromise=this._sendLoop()}send(a){return this._bufferData(a),this._transportResult||(this._transportResult=new mr),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(a){if(this._buffer.length&&typeof this._buffer[0]!=typeof a)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof a}`);this._buffer.push(a),this._sendBufferedData.resolve()}_sendLoop(){var a=this;return(0,J.A)(function*(){for(;;){if(yield a._sendBufferedData.promise,!a._executing){a._transportResult&&a._transportResult.reject("Connection stopped.");break}a._sendBufferedData=new mr;const l=a._transportResult;a._transportResult=void 0;const f="string"==typeof a._buffer[0]?a._buffer.join(""):Yo._concatBuffers(a._buffer);a._buffer.length=0;try{yield a._transport.send(f),l.resolve()}catch(g){l.reject(g)}}})()}static _concatBuffers(a){const l=a.map(m=>m.byteLength).reduce((m,E)=>m+E),f=new Uint8Array(l);let g=0;for(const m of a)f.set(new Uint8Array(m),g),g+=m.byteLength;return f.buffer}}class mr{constructor(){this.promise=new Promise((a,l)=>[this._resolver,this._rejecter]=[a,l])}resolve(){this._resolver()}reject(a){this._rejecter(a)}}class Nt{static write(a){return`${a}${Nt.RecordSeparator}`}static parse(a){if(a[a.length-1]!==Nt.RecordSeparator)throw new Error("Message is incomplete.");const l=a.split(Nt.RecordSeparator);return l.pop(),l}}Nt.RecordSeparatorCode=30,Nt.RecordSeparator=String.fromCharCode(Nt.RecordSeparatorCode);class Nc{writeHandshakeRequest(a){return Nt.write(JSON.stringify(a))}parseHandshakeResponse(a){let l,f;if(jt(a)){const w=new Uint8Array(a),x=w.indexOf(Nt.RecordSeparatorCode);if(-1===x)throw new Error("Message is incomplete.");const N=x+1;l=String.fromCharCode.apply(null,Array.prototype.slice.call(w.slice(0,N))),f=w.byteLength>N?w.slice(N).buffer:null}else{const w=a,x=w.indexOf(Nt.RecordSeparator);if(-1===x)throw new Error("Message is incomplete.");const N=x+1;l=w.substring(0,N),f=w.length>N?w.substring(N):null}const g=Nt.parse(l),m=JSON.parse(g[0]);if(m.type)throw new Error("Expected a handshake response from the server.");return[f,m]}}var B=function(p){return p[p.Invocation=1]="Invocation",p[p.StreamItem=2]="StreamItem",p[p.Completion=3]="Completion",p[p.StreamInvocation=4]="StreamInvocation",p[p.CancelInvocation=5]="CancelInvocation",p[p.Ping=6]="Ping",p[p.Close=7]="Close",p[p.Ack=8]="Ack",p[p.Sequence=9]="Sequence",p}(B||{});class hn{constructor(){this.observers=[]}next(a){for(const l of this.observers)l.next(a)}error(a){for(const l of this.observers)l.error&&l.error(a)}complete(){for(const a of this.observers)a.complete&&a.complete()}subscribe(a){return this.observers.push(a),new C(this,a)}}class Hr{constructor(a,l,f){this._bufferSize=1e5,this._messages=[],this._totalMessageCount=0,this._waitForSequenceMessage=!1,this._nextReceivingSequenceId=1,this._latestReceivedSequenceId=0,this._bufferedByteCount=0,this._reconnectInProgress=!1,this._protocol=a,this._connection=l,this._bufferSize=f}_send(a){var l=this;return(0,J.A)(function*(){const f=l._protocol.writeMessage(a);let g=Promise.resolve();if(l._isInvocationMessage(a)){l._totalMessageCount++;let m=()=>{},E=()=>{};jt(f)?l._bufferedByteCount+=f.byteLength:l._bufferedByteCount+=f.length,l._bufferedByteCount>=l._bufferSize&&(g=new Promise((w,x)=>{m=w,E=x})),l._messages.push(new Cn(f,l._totalMessageCount,m,E))}try{l._reconnectInProgress||(yield l._connection.send(f))}catch{l._disconnected()}yield g})()}_ack(a){let l=-1;for(let f=0;f<this._messages.length;f++){const g=this._messages[f];if(g._id<=a.sequenceId)l=f,jt(g._message)?this._bufferedByteCount-=g._message.byteLength:this._bufferedByteCount-=g._message.length,g._resolver();else{if(!(this._bufferedByteCount<this._bufferSize))break;g._resolver()}}-1!==l&&(this._messages=this._messages.slice(l+1))}_shouldProcessMessage(a){if(this._waitForSequenceMessage)return a.type===B.Sequence&&(this._waitForSequenceMessage=!1,!0);if(!this._isInvocationMessage(a))return!0;const l=this._nextReceivingSequenceId;return this._nextReceivingSequenceId++,l<=this._latestReceivedSequenceId?(l===this._latestReceivedSequenceId&&this._ackTimer(),!1):(this._latestReceivedSequenceId=l,this._ackTimer(),!0)}_resetSequence(a){a.sequenceId>this._nextReceivingSequenceId?this._connection.stop(new Error("Sequence ID greater than amount of messages we've received.")):this._nextReceivingSequenceId=a.sequenceId}_disconnected(){this._reconnectInProgress=!0,this._waitForSequenceMessage=!0}_resend(){var a=this;return(0,J.A)(function*(){const l=0!==a._messages.length?a._messages[0]._id:a._totalMessageCount+1;yield a._connection.send(a._protocol.writeMessage({type:B.Sequence,sequenceId:l}));const f=a._messages;for(const g of f)yield a._connection.send(g._message);a._reconnectInProgress=!1})()}_dispose(a){a??(a=new Error("Unable to reconnect to server."));for(const l of this._messages)l._rejector(a)}_isInvocationMessage(a){switch(a.type){case B.Invocation:case B.StreamItem:case B.Completion:case B.StreamInvocation:case B.CancelInvocation:return!0;case B.Close:case B.Sequence:case B.Ping:case B.Ack:return!1}}_ackTimer(){var a=this;void 0===this._ackTimerHandle&&(this._ackTimerHandle=setTimeout((0,J.A)(function*(){try{a._reconnectInProgress||(yield a._connection.send(a._protocol.writeMessage({type:B.Ack,sequenceId:a._latestReceivedSequenceId})))}catch{}clearTimeout(a._ackTimerHandle),a._ackTimerHandle=void 0}),1e3))}}class Cn{constructor(a,l,f,g){this._message=a,this._id=l,this._resolver=f,this._rejector=g}}var Be=function(p){return p.Disconnected="Disconnected",p.Connecting="Connecting",p.Connected="Connected",p.Disconnecting="Disconnecting",p.Reconnecting="Reconnecting",p}(Be||{});class Jo{static create(a,l,f,g,m,E,w){return new Jo(a,l,f,g,m,E,w)}constructor(a,l,f,g,m,E,w){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(R.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},Ue.isRequired(a,"connection"),Ue.isRequired(l,"logger"),Ue.isRequired(f,"protocol"),this.serverTimeoutInMilliseconds=m??3e4,this.keepAliveIntervalInMilliseconds=E??15e3,this._statefulReconnectBufferSize=w??1e5,this._logger=l,this._protocol=f,this.connection=a,this._reconnectPolicy=g,this._handshakeProtocol=new Nc,this.connection.onreceive=x=>this._processIncomingData(x),this.connection.onclose=x=>this._connectionClosed(x),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=Be.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:B.Ping})}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(a){if(this._connectionState!==Be.Disconnected&&this._connectionState!==Be.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!a)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=a}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}_startWithStateTransitions(){var a=this;return(0,J.A)(function*(){if(a._connectionState!==Be.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));a._connectionState=Be.Connecting,a._logger.log(R.Debug,"Starting HubConnection.");try{yield a._startInternal(),$e.isBrowser&&window.document.addEventListener("freeze",a._freezeEventListener),a._connectionState=Be.Connected,a._connectionStarted=!0,a._logger.log(R.Debug,"HubConnection connected successfully.")}catch(l){return a._connectionState=Be.Disconnected,a._logger.log(R.Debug,`HubConnection failed to start successfully because of error '${l}'.`),Promise.reject(l)}})()}_startInternal(){var a=this;return(0,J.A)(function*(){a._stopDuringStartError=void 0,a._receivedHandshakeResponse=!1;const l=new Promise((f,g)=>{a._handshakeResolver=f,a._handshakeRejecter=g});yield a.connection.start(a._protocol.transferFormat);try{let f=a._protocol.version;a.connection.features.reconnect||(f=1);const g={protocol:a._protocol.name,version:f};if(a._logger.log(R.Debug,"Sending handshake request."),yield a._sendMessage(a._handshakeProtocol.writeHandshakeRequest(g)),a._logger.log(R.Information,`Using HubProtocol '${a._protocol.name}'.`),a._cleanupTimeout(),a._resetTimeoutPeriod(),a._resetKeepAliveInterval(),yield l,a._stopDuringStartError)throw a._stopDuringStartError;!!a.connection.features.reconnect&&(a._messageBuffer=new Hr(a._protocol,a.connection,a._statefulReconnectBufferSize),a.connection.features.disconnected=a._messageBuffer._disconnected.bind(a._messageBuffer),a.connection.features.resend=()=>{if(a._messageBuffer)return a._messageBuffer._resend()}),a.connection.features.inherentKeepAlive||(yield a._sendMessage(a._cachedPingMessage))}catch(f){throw a._logger.log(R.Debug,`Hub handshake failed with error '${f}' during start(). Stopping HubConnection.`),a._cleanupTimeout(),a._cleanupPingTimer(),yield a.connection.stop(f),f}})()}stop(){var a=this;return(0,J.A)(function*(){const l=a._startPromise;a.connection.features.reconnect=!1,a._stopPromise=a._stopInternal(),yield a._stopPromise;try{yield l}catch{}})()}_stopInternal(a){if(this._connectionState===Be.Disconnected)return this._logger.log(R.Debug,`Call to HubConnection.stop(${a}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this._connectionState===Be.Disconnecting)return this._logger.log(R.Debug,`Call to HttpConnection.stop(${a}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;const l=this._connectionState;return this._connectionState=Be.Disconnecting,this._logger.log(R.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(R.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(l===Be.Connected&&this._sendCloseMessage(),this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=a||new Vt("The connection was stopped before the hub handshake could complete."),this.connection.stop(a))}_sendCloseMessage(){var a=this;return(0,J.A)(function*(){try{yield a._sendWithProtocol(a._createCloseMessage())}catch{}})()}stream(a,...l){const[f,g]=this._replaceStreamingParams(l),m=this._createStreamInvocation(a,l,g);let E;const w=new hn;return w.cancelCallback=()=>{const x=this._createCancelInvocation(m.invocationId);return delete this._callbacks[m.invocationId],E.then(()=>this._sendWithProtocol(x))},this._callbacks[m.invocationId]=(x,N)=>{N?w.error(N):x&&(x.type===B.Completion?x.error?w.error(new Error(x.error)):w.complete():w.next(x.item))},E=this._sendWithProtocol(m).catch(x=>{w.error(x),delete this._callbacks[m.invocationId]}),this._launchStreams(f,E),w}_sendMessage(a){return this._resetKeepAliveInterval(),this.connection.send(a)}_sendWithProtocol(a){return this._messageBuffer?this._messageBuffer._send(a):this._sendMessage(this._protocol.writeMessage(a))}send(a,...l){const[f,g]=this._replaceStreamingParams(l),m=this._sendWithProtocol(this._createInvocation(a,l,!0,g));return this._launchStreams(f,m),m}invoke(a,...l){const[f,g]=this._replaceStreamingParams(l),m=this._createInvocation(a,l,!1,g);return new Promise((w,x)=>{this._callbacks[m.invocationId]=(b,Q)=>{Q?x(Q):b&&(b.type===B.Completion?b.error?x(new Error(b.error)):w(b.result):x(new Error(`Unexpected message type: ${b.type}`)))};const N=this._sendWithProtocol(m).catch(b=>{x(b),delete this._callbacks[m.invocationId]});this._launchStreams(f,N)})}on(a,l){!a||!l||(a=a.toLowerCase(),this._methods[a]||(this._methods[a]=[]),-1===this._methods[a].indexOf(l)&&this._methods[a].push(l))}off(a,l){if(!a)return;a=a.toLowerCase();const f=this._methods[a];if(f)if(l){const g=f.indexOf(l);-1!==g&&(f.splice(g,1),0===f.length&&delete this._methods[a])}else delete this._methods[a]}onclose(a){a&&this._closedCallbacks.push(a)}onreconnecting(a){a&&this._reconnectingCallbacks.push(a)}onreconnected(a){a&&this._reconnectedCallbacks.push(a)}_processIncomingData(a){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(a=this._processHandshakeResponse(a),this._receivedHandshakeResponse=!0),a){const l=this._protocol.parseMessages(a,this._logger);for(const f of l)if(!this._messageBuffer||this._messageBuffer._shouldProcessMessage(f))switch(f.type){case B.Invocation:this._invokeClientMethod(f);break;case B.StreamItem:case B.Completion:{const g=this._callbacks[f.invocationId];if(g){f.type===B.Completion&&delete this._callbacks[f.invocationId];try{g(f)}catch(m){this._logger.log(R.Error,`Stream callback threw error: ${Ie(m)}`)}}break}case B.Ping:break;case B.Close:{this._logger.log(R.Information,"Close message received from server.");const g=f.error?new Error("Server returned an error on close: "+f.error):void 0;!0===f.allowReconnect?this.connection.stop(g):this._stopPromise=this._stopInternal(g);break}case B.Ack:this._messageBuffer&&this._messageBuffer._ack(f);break;case B.Sequence:this._messageBuffer&&this._messageBuffer._resetSequence(f);break;default:this._logger.log(R.Warning,`Invalid message type: ${f.type}.`)}}this._resetTimeoutPeriod()}_processHandshakeResponse(a){let l,f;try{[f,l]=this._handshakeProtocol.parseHandshakeResponse(a)}catch(g){const m="Error parsing handshake response: "+g;this._logger.log(R.Error,m);const E=new Error(m);throw this._handshakeRejecter(E),E}if(l.error){const g="Server returned handshake error: "+l.error;this._logger.log(R.Error,g);const m=new Error(g);throw this._handshakeRejecter(m),m}return this._logger.log(R.Debug,"Server handshake complete."),this._handshakeResolver(),f}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=(new Date).getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){var a=this;if(!(this.connection.features&&this.connection.features.inherentKeepAlive||(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),void 0!==this._pingServerHandle))){let l=this._nextKeepAlive-(new Date).getTime();l<0&&(l=0),this._pingServerHandle=setTimeout((0,J.A)(function*(){if(a._connectionState===Be.Connected)try{yield a._sendMessage(a._cachedPingMessage)}catch{a._cleanupPingTimer()}}),l)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}_invokeClientMethod(a){var l=this;return(0,J.A)(function*(){const f=a.target.toLowerCase(),g=l._methods[f];if(!g)return l._logger.log(R.Warning,`No client method with the name '${f}' found.`),void(a.invocationId&&(l._logger.log(R.Warning,`No result given for '${f}' method and invocation ID '${a.invocationId}'.`),yield l._sendWithProtocol(l._createCompletionMessage(a.invocationId,"Client didn't provide a result.",null))));const m=g.slice(),E=!!a.invocationId;let w,x,N;for(const b of m)try{const Q=w;w=yield b.apply(l,a.arguments),E&&w&&Q&&(l._logger.log(R.Error,`Multiple results provided for '${f}'. Sending error to server.`),N=l._createCompletionMessage(a.invocationId,"Client provided multiple results.",null)),x=void 0}catch(Q){x=Q,l._logger.log(R.Error,`A callback for the method '${f}' threw error '${Q}'.`)}N?yield l._sendWithProtocol(N):E?(x?N=l._createCompletionMessage(a.invocationId,`${x}`,null):void 0!==w?N=l._createCompletionMessage(a.invocationId,null,w):(l._logger.log(R.Warning,`No result given for '${f}' method and invocation ID '${a.invocationId}'.`),N=l._createCompletionMessage(a.invocationId,"Client didn't provide a result.",null)),yield l._sendWithProtocol(N)):w&&l._logger.log(R.Error,`Result given for '${f}' method but server is not expecting a result.`)})()}_connectionClosed(a){this._logger.log(R.Debug,`HubConnection.connectionClosed(${a}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||a||new Vt("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(a||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===Be.Disconnecting?this._completeClose(a):this._connectionState===Be.Connected&&this._reconnectPolicy?this._reconnect(a):this._connectionState===Be.Connected&&this._completeClose(a)}_completeClose(a){if(this._connectionStarted){this._connectionState=Be.Disconnected,this._connectionStarted=!1,this._messageBuffer&&(this._messageBuffer._dispose(a??new Error("Connection closed.")),this._messageBuffer=void 0),$e.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(l=>l.apply(this,[a]))}catch(l){this._logger.log(R.Error,`An onclose callback called with error '${a}' threw error '${l}'.`)}}}_reconnect(a){var l=this;return(0,J.A)(function*(){const f=Date.now();let g=0,m=void 0!==a?a:new Error("Attempting to reconnect due to a unknown error."),E=l._getNextRetryDelay(g++,0,m);if(null===E)return l._logger.log(R.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),void l._completeClose(a);if(l._connectionState=Be.Reconnecting,l._logger.log(R.Information,a?`Connection reconnecting because of error '${a}'.`:"Connection reconnecting."),0!==l._reconnectingCallbacks.length){try{l._reconnectingCallbacks.forEach(w=>w.apply(l,[a]))}catch(w){l._logger.log(R.Error,`An onreconnecting callback called with error '${a}' threw error '${w}'.`)}if(l._connectionState!==Be.Reconnecting)return void l._logger.log(R.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.")}for(;null!==E;){if(l._logger.log(R.Information,`Reconnect attempt number ${g} will start in ${E} ms.`),yield new Promise(w=>{l._reconnectDelayHandle=setTimeout(w,E)}),l._reconnectDelayHandle=void 0,l._connectionState!==Be.Reconnecting)return void l._logger.log(R.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");try{if(yield l._startInternal(),l._connectionState=Be.Connected,l._logger.log(R.Information,"HubConnection reconnected successfully."),0!==l._reconnectedCallbacks.length)try{l._reconnectedCallbacks.forEach(w=>w.apply(l,[l.connection.connectionId]))}catch(w){l._logger.log(R.Error,`An onreconnected callback called with connectionId '${l.connection.connectionId}; threw error '${w}'.`)}return}catch(w){if(l._logger.log(R.Information,`Reconnect attempt failed because of error '${w}'.`),l._connectionState!==Be.Reconnecting)return l._logger.log(R.Debug,`Connection moved to the '${l._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),void(l._connectionState===Be.Disconnecting&&l._completeClose());m=w instanceof Error?w:new Error(w.toString()),E=l._getNextRetryDelay(g++,Date.now()-f,m)}}l._logger.log(R.Information,`Reconnect retries have been exhausted after ${Date.now()-f} ms and ${g} failed attempts. Connection disconnecting.`),l._completeClose()})()}_getNextRetryDelay(a,l,f){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:l,previousRetryCount:a,retryReason:f})}catch(g){return this._logger.log(R.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${a}, ${l}) threw error '${g}'.`),null}}_cancelCallbacksWithError(a){const l=this._callbacks;this._callbacks={},Object.keys(l).forEach(f=>{const g=l[f];try{g(null,a)}catch(m){this._logger.log(R.Error,`Stream 'error' callback called with '${a}' threw error: ${Ie(m)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(a,l,f,g){if(f)return 0!==g.length?{arguments:l,streamIds:g,target:a,type:B.Invocation}:{arguments:l,target:a,type:B.Invocation};{const m=this._invocationId;return this._invocationId++,0!==g.length?{arguments:l,invocationId:m.toString(),streamIds:g,target:a,type:B.Invocation}:{arguments:l,invocationId:m.toString(),target:a,type:B.Invocation}}}_launchStreams(a,l){if(0!==a.length){l||(l=Promise.resolve());for(const f in a)a[f].subscribe({complete:()=>{l=l.then(()=>this._sendWithProtocol(this._createCompletionMessage(f)))},error:g=>{let m;m=g instanceof Error?g.message:g&&g.toString?g.toString():"Unknown error",l=l.then(()=>this._sendWithProtocol(this._createCompletionMessage(f,m)))},next:g=>{l=l.then(()=>this._sendWithProtocol(this._createStreamItemMessage(f,g)))}})}}_replaceStreamingParams(a){const l=[],f=[];for(let g=0;g<a.length;g++){const m=a[g];if(this._isObservable(m)){const E=this._invocationId;this._invocationId++,l[E]=m,f.push(E.toString()),a.splice(g,1)}}return[l,f]}_isObservable(a){return a&&a.subscribe&&"function"==typeof a.subscribe}_createStreamInvocation(a,l,f){const g=this._invocationId;return this._invocationId++,0!==f.length?{arguments:l,invocationId:g.toString(),streamIds:f,target:a,type:B.StreamInvocation}:{arguments:l,invocationId:g.toString(),target:a,type:B.StreamInvocation}}_createCancelInvocation(a){return{invocationId:a,type:B.CancelInvocation}}_createStreamItemMessage(a,l){return{invocationId:a,item:l,type:B.StreamItem}}_createCompletionMessage(a,l,f){return l?{error:l,invocationId:a,type:B.Completion}:{invocationId:a,result:f,type:B.Completion}}_createCloseMessage(){return{type:B.Close}}}class Pc{constructor(){this.name="json",this.version=2,this.transferFormat=mt.Text}parseMessages(a,l){if("string"!=typeof a)throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!a)return[];null===l&&(l=rn.instance);const f=Nt.parse(a),g=[];for(const m of f){const E=JSON.parse(m);if("number"!=typeof E.type)throw new Error("Invalid payload.");switch(E.type){case B.Invocation:this._isInvocationMessage(E);break;case B.StreamItem:this._isStreamItemMessage(E);break;case B.Completion:this._isCompletionMessage(E);break;case B.Ping:case B.Close:break;case B.Ack:this._isAckMessage(E);break;case B.Sequence:this._isSequenceMessage(E);break;default:l.log(R.Information,"Unknown message type '"+E.type+"' ignored.");continue}g.push(E)}return g}writeMessage(a){return Nt.write(JSON.stringify(a))}_isInvocationMessage(a){this._assertNotEmptyString(a.target,"Invalid payload for Invocation message."),void 0!==a.invocationId&&this._assertNotEmptyString(a.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(a){if(this._assertNotEmptyString(a.invocationId,"Invalid payload for StreamItem message."),void 0===a.item)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(a){if(a.result&&a.error)throw new Error("Invalid payload for Completion message.");!a.result&&a.error&&this._assertNotEmptyString(a.error,"Invalid payload for Completion message."),this._assertNotEmptyString(a.invocationId,"Invalid payload for Completion message.")}_isAckMessage(a){if("number"!=typeof a.sequenceId)throw new Error("Invalid SequenceId for Ack message.")}_isSequenceMessage(a){if("number"!=typeof a.sequenceId)throw new Error("Invalid SequenceId for Sequence message.")}_assertNotEmptyString(a,l){if("string"!=typeof a||""===a)throw new Error(l)}}const vr={trace:R.Trace,debug:R.Debug,info:R.Information,information:R.Information,warn:R.Warning,warning:R.Warning,error:R.Error,critical:R.Critical,none:R.None};class ei{configureLogging(a){if(Ue.isRequired(a,"logging"),function Uf(p){return void 0!==p.log}(a))this.logger=a;else if("string"==typeof a){const l=function Xo(p){const a=vr[p.toLowerCase()];if(typeof a<"u")return a;throw new Error(`Unknown log level: ${p}`)}(a);this.logger=new k(l)}else this.logger=new k(a);return this}withUrl(a,l){return Ue.isRequired(a,"url"),Ue.isNotEmpty(a,"url"),this.url=a,this.httpConnectionOptions="object"==typeof l?{...this.httpConnectionOptions,...l}:{...this.httpConnectionOptions,transport:l},this}withHubProtocol(a){return Ue.isRequired(a,"protocol"),this.protocol=a,this}withAutomaticReconnect(a){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return this.reconnectPolicy=a?Array.isArray(a)?new qe(a):a:new qe,this}withServerTimeout(a){return Ue.isRequired(a,"milliseconds"),this._serverTimeoutInMilliseconds=a,this}withKeepAliveInterval(a){return Ue.isRequired(a,"milliseconds"),this._keepAliveIntervalInMilliseconds=a,this}withStatefulReconnect(a){return void 0===this.httpConnectionOptions&&(this.httpConnectionOptions={}),this.httpConnectionOptions._useStatefulReconnect=!0,this._statefulReconnectBufferSize=a?.bufferSize,this}build(){const a=this.httpConnectionOptions||{};if(void 0===a.logger&&(a.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const l=new jf(this.url,a);return Jo.create(l,this.logger||rn.instance,this.protocol||new Pc,this.reconnectPolicy,this._serverTimeoutInMilliseconds,this._keepAliveIntervalInMilliseconds,this._statefulReconnectBufferSize)}}var on=4294967295;function xs(p,a,l){var f=Math.floor(l/4294967296),g=l;p.setUint32(a,f),p.setUint32(a+4,g)}function ti(p,a){return 4294967296*p.getInt32(a)+p.getUint32(a+4)}var $r,Br,ni,Wr=(typeof process>"u"||"never"!==(null===($r=null==process?void 0:process.env)||void 0===$r?void 0:$r.TEXT_ENCODING))&&typeof TextEncoder<"u"&&typeof TextDecoder<"u";function Oc(p){for(var a=p.length,l=0,f=0;f<a;){var g=p.charCodeAt(f++);if(4294967168&g)if(4294965248&g){if(g>=55296&&g<=56319&&f<a){var m=p.charCodeAt(f);56320==(64512&m)&&(++f,g=((1023&g)<<10)+(1023&m)+65536)}l+=4294901760&g?4:3}else l+=2;else l++}return l}var tr=Wr?new TextEncoder:void 0,Hf=Wr?typeof process<"u"&&"force"!==(null===(Br=null==process?void 0:process.env)||void 0===Br?void 0:Br.TEXT_ENCODING)?200:0:on,Wf=tr?.encodeInto?function Bf(p,a,l){tr.encodeInto(p,a.subarray(l))}:function $f(p,a,l){a.set(tr.encode(p),l)};function Lc(p,a,l){for(var f=a,g=f+l,m=[],E="";f<g;){var w=p[f++];if(128&w)if(192==(224&w)){var x=63&p[f++];m.push((31&w)<<6|x)}else if(224==(240&w)){x=63&p[f++];var N=63&p[f++];m.push((31&w)<<12|x<<6|N)}else if(240==(248&w)){var Q=(7&w)<<18|(x=63&p[f++])<<12|(N=63&p[f++])<<6|63&p[f++];Q>65535&&(m.push((Q-=65536)>>>10&1023|55296),Q=56320|1023&Q),m.push(Q)}else m.push(w);else m.push(w);m.length>=4096&&(E+=String.fromCharCode.apply(String,m),m.length=0)}return m.length>0&&(E+=String.fromCharCode.apply(String,m)),E}var Fc=Wr?new TextDecoder:null,Vc=Wr?typeof process<"u"&&"force"!==(null===(ni=null==process?void 0:process.env)||void 0===ni?void 0:ni.TEXT_DECODER)?200:0:on,yr=function(){return function p(a,l){this.type=a,this.data=l}}(),oi=function(){var p=function(a,l){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,g){f.__proto__=g}||function(f,g){for(var m in g)Object.prototype.hasOwnProperty.call(g,m)&&(f[m]=g[m])})(a,l)};return function(a,l){if("function"!=typeof l&&null!==l)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");function f(){this.constructor=a}p(a,l),a.prototype=null===l?Object.create(l):(f.prototype=l.prototype,new f)}}(),Ut=function(p){function a(l){var f=p.call(this,l)||this,g=Object.create(a.prototype);return Object.setPrototypeOf(f,g),Object.defineProperty(f,"name",{configurable:!0,enumerable:!1,value:a.name}),f}return oi(a,p),a}(Error),zc={type:-1,encode:function $c(p){if(p instanceof Date){var a=function qf(p){var a=p.getTime(),l=Math.floor(a/1e3),f=1e6*(a-1e3*l),g=Math.floor(f/1e9);return{sec:l+g,nsec:f-1e9*g}}(p);return function Gf(p){var g,a=p.sec,l=p.nsec;if(a>=0&&l>=0&&a<=17179869183){if(0===l&&a<=4294967295){var f=new Uint8Array(4);return(g=new DataView(f.buffer)).setUint32(0,a),f}var m=a/4294967296,E=4294967295&a;return f=new Uint8Array(8),(g=new DataView(f.buffer)).setUint32(0,l<<2|3&m),g.setUint32(4,E),f}return f=new Uint8Array(12),(g=new DataView(f.buffer)).setUint32(0,l),xs(g,4,a),f}(a)}return null},decode:function Wc(p){var a=function Bc(p){var a=new DataView(p.buffer,p.byteOffset,p.byteLength);switch(p.byteLength){case 4:return{sec:a.getUint32(0),nsec:0};case 8:var g=a.getUint32(0);return{sec:4294967296*(3&g)+a.getUint32(4),nsec:g>>>2};case 12:return{sec:ti(a,4),nsec:a.getUint32(0)};default:throw new Ut("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(p.length))}}(p);return new Date(1e3*a.sec+a.nsec/1e6)}},Ns=function(){function p(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(zc)}return p.prototype.register=function(a){var l=a.type,f=a.encode,g=a.decode;if(l>=0)this.encoders[l]=f,this.decoders[l]=g;else{var m=1+l;this.builtInEncoders[m]=f,this.builtInDecoders[m]=g}},p.prototype.tryToEncode=function(a,l){for(var f=0;f<this.builtInEncoders.length;f++)if(null!=(g=this.builtInEncoders[f])&&null!=(m=g(a,l)))return new yr(-1-f,m);for(f=0;f<this.encoders.length;f++){var g,m;if(null!=(g=this.encoders[f])&&null!=(m=g(a,l)))return new yr(f,m)}return a instanceof yr?a:null},p.prototype.decode=function(a,l,f){var g=l<0?this.builtInDecoders[-1-l]:this.decoders[l];return g?g(a,l,f):new yr(l,a)},p.defaultCodec=new p,p}();function zr(p){return p instanceof Uint8Array?p:ArrayBuffer.isView(p)?new Uint8Array(p.buffer,p.byteOffset,p.byteLength):p instanceof ArrayBuffer?new Uint8Array(p):Uint8Array.from(p)}var Zc=function(){function p(a,l,f,g,m,E,w,x){void 0===a&&(a=Ns.defaultCodec),void 0===l&&(l=void 0),void 0===f&&(f=100),void 0===g&&(g=2048),void 0===m&&(m=!1),void 0===E&&(E=!1),void 0===w&&(w=!1),void 0===x&&(x=!1),this.extensionCodec=a,this.context=l,this.maxDepth=f,this.initialBufferSize=g,this.sortKeys=m,this.forceFloat32=E,this.ignoreUndefined=w,this.forceIntegerToFloat=x,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return p.prototype.reinitializeState=function(){this.pos=0},p.prototype.encodeSharedRef=function(a){return this.reinitializeState(),this.doEncode(a,1),this.bytes.subarray(0,this.pos)},p.prototype.encode=function(a){return this.reinitializeState(),this.doEncode(a,1),this.bytes.slice(0,this.pos)},p.prototype.doEncode=function(a,l){if(l>this.maxDepth)throw new Error("Too deep objects in depth ".concat(l));null==a?this.encodeNil():"boolean"==typeof a?this.encodeBoolean(a):"number"==typeof a?this.encodeNumber(a):"string"==typeof a?this.encodeString(a):this.encodeObject(a,l)},p.prototype.ensureBufferSizeToWrite=function(a){var l=this.pos+a;this.view.byteLength<l&&this.resizeBuffer(2*l)},p.prototype.resizeBuffer=function(a){var l=new ArrayBuffer(a),f=new Uint8Array(l),g=new DataView(l);f.set(this.bytes),this.view=g,this.bytes=f},p.prototype.encodeNil=function(){this.writeU8(192)},p.prototype.encodeBoolean=function(a){this.writeU8(!1===a?194:195)},p.prototype.encodeNumber=function(a){Number.isSafeInteger(a)&&!this.forceIntegerToFloat?a>=0?a<128?this.writeU8(a):a<256?(this.writeU8(204),this.writeU8(a)):a<65536?(this.writeU8(205),this.writeU16(a)):a<4294967296?(this.writeU8(206),this.writeU32(a)):(this.writeU8(207),this.writeU64(a)):a>=-32?this.writeU8(224|a+32):a>=-128?(this.writeU8(208),this.writeI8(a)):a>=-32768?(this.writeU8(209),this.writeI16(a)):a>=-2147483648?(this.writeU8(210),this.writeI32(a)):(this.writeU8(211),this.writeI64(a)):this.forceFloat32?(this.writeU8(202),this.writeF32(a)):(this.writeU8(203),this.writeF64(a))},p.prototype.writeStringHeader=function(a){if(a<32)this.writeU8(160+a);else if(a<256)this.writeU8(217),this.writeU8(a);else if(a<65536)this.writeU8(218),this.writeU16(a);else{if(!(a<4294967296))throw new Error("Too long string: ".concat(a," bytes in UTF-8"));this.writeU8(219),this.writeU32(a)}},p.prototype.encodeString=function(a){if(a.length>Hf){var g=Oc(a);this.ensureBufferSizeToWrite(5+g),this.writeStringHeader(g),Wf(a,this.bytes,this.pos),this.pos+=g}else g=Oc(a),this.ensureBufferSizeToWrite(5+g),this.writeStringHeader(g),function ri(p,a,l){for(var f=p.length,g=l,m=0;m<f;){var E=p.charCodeAt(m++);if(4294967168&E){if(4294965248&E){if(E>=55296&&E<=56319&&m<f){var w=p.charCodeAt(m);56320==(64512&w)&&(++m,E=((1023&E)<<10)+(1023&w)+65536)}4294901760&E?(a[g++]=E>>18&7|240,a[g++]=E>>12&63|128,a[g++]=E>>6&63|128):(a[g++]=E>>12&15|224,a[g++]=E>>6&63|128)}else a[g++]=E>>6&31|192;a[g++]=63&E|128}else a[g++]=E}}(a,this.bytes,this.pos),this.pos+=g},p.prototype.encodeObject=function(a,l){var f=this.extensionCodec.tryToEncode(a,this.context);if(null!=f)this.encodeExtension(f);else if(Array.isArray(a))this.encodeArray(a,l);else if(ArrayBuffer.isView(a))this.encodeBinary(a);else{if("object"!=typeof a)throw new Error("Unrecognized object: ".concat(Object.prototype.toString.apply(a)));this.encodeMap(a,l)}},p.prototype.encodeBinary=function(a){var l=a.byteLength;if(l<256)this.writeU8(196),this.writeU8(l);else if(l<65536)this.writeU8(197),this.writeU16(l);else{if(!(l<4294967296))throw new Error("Too large binary: ".concat(l));this.writeU8(198),this.writeU32(l)}var f=zr(a);this.writeU8a(f)},p.prototype.encodeArray=function(a,l){var f=a.length;if(f<16)this.writeU8(144+f);else if(f<65536)this.writeU8(220),this.writeU16(f);else{if(!(f<4294967296))throw new Error("Too large array: ".concat(f));this.writeU8(221),this.writeU32(f)}for(var g=0,m=a;g<m.length;g++)this.doEncode(m[g],l+1)},p.prototype.countWithoutUndefined=function(a,l){for(var f=0,g=0,m=l;g<m.length;g++)void 0!==a[m[g]]&&f++;return f},p.prototype.encodeMap=function(a,l){var f=Object.keys(a);this.sortKeys&&f.sort();var g=this.ignoreUndefined?this.countWithoutUndefined(a,f):f.length;if(g<16)this.writeU8(128+g);else if(g<65536)this.writeU8(222),this.writeU16(g);else{if(!(g<4294967296))throw new Error("Too large map object: ".concat(g));this.writeU8(223),this.writeU32(g)}for(var m=0,E=f;m<E.length;m++){var w=E[m],x=a[w];this.ignoreUndefined&&void 0===x||(this.encodeString(w),this.doEncode(x,l+1))}},p.prototype.encodeExtension=function(a){var l=a.data.length;if(1===l)this.writeU8(212);else if(2===l)this.writeU8(213);else if(4===l)this.writeU8(214);else if(8===l)this.writeU8(215);else if(16===l)this.writeU8(216);else if(l<256)this.writeU8(199),this.writeU8(l);else if(l<65536)this.writeU8(200),this.writeU16(l);else{if(!(l<4294967296))throw new Error("Too large extension object: ".concat(l));this.writeU8(201),this.writeU32(l)}this.writeI8(a.type),this.writeU8a(a.data)},p.prototype.writeU8=function(a){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,a),this.pos++},p.prototype.writeU8a=function(a){var l=a.length;this.ensureBufferSizeToWrite(l),this.bytes.set(a,this.pos),this.pos+=l},p.prototype.writeI8=function(a){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,a),this.pos++},p.prototype.writeU16=function(a){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,a),this.pos+=2},p.prototype.writeI16=function(a){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,a),this.pos+=2},p.prototype.writeU32=function(a){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,a),this.pos+=4},p.prototype.writeI32=function(a){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,a),this.pos+=4},p.prototype.writeF32=function(a){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,a),this.pos+=4},p.prototype.writeF64=function(a){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,a),this.pos+=8},p.prototype.writeU64=function(a){this.ensureBufferSizeToWrite(8),function Rc(p,a,l){var g=l;p.setUint32(a,l/4294967296),p.setUint32(a+4,g)}(this.view,this.pos,a),this.pos+=8},p.prototype.writeI64=function(a){this.ensureBufferSizeToWrite(8),xs(this.view,this.pos,a),this.pos+=8},p}();function ii(p){return"".concat(p<0?"-":"","0x").concat(Math.abs(p).toString(16).padStart(2,"0"))}var Yc=function(){function p(a,l){void 0===a&&(a=16),void 0===l&&(l=16),this.maxKeyLength=a,this.maxLengthPerKey=l,this.hit=0,this.miss=0,this.caches=[];for(var f=0;f<this.maxKeyLength;f++)this.caches.push([])}return p.prototype.canBeCached=function(a){return a>0&&a<=this.maxKeyLength},p.prototype.find=function(a,l,f){e:for(var m=0,E=this.caches[f-1];m<E.length;m++){for(var w=E[m],x=w.bytes,N=0;N<f;N++)if(x[N]!==a[l+N])continue e;return w.str}return null},p.prototype.store=function(a,l){var f=this.caches[a.length-1],g={bytes:a,str:l};f.length>=this.maxLengthPerKey?f[Math.random()*f.length|0]=g:f.push(g)},p.prototype.decode=function(a,l,f){var g=this.find(a,l,f);if(null!=g)return this.hit++,g;this.miss++;var m=Lc(a,l,f),E=Uint8Array.prototype.slice.call(a,l,l+f);return this.store(E,m),m},p}(),Gr=function(p,a){var f,g,m,E,l={label:0,sent:function(){if(1&m[0])throw m[1];return m[1]},trys:[],ops:[]};return E={next:w(0),throw:w(1),return:w(2)},"function"==typeof Symbol&&(E[Symbol.iterator]=function(){return this}),E;function w(N){return function(b){return function x(N){if(f)throw new TypeError("Generator is already executing.");for(;l;)try{if(f=1,g&&(m=2&N[0]?g.return:N[0]?g.throw||((m=g.return)&&m.call(g),0):g.next)&&!(m=m.call(g,N[1])).done)return m;switch(g=0,m&&(N=[2&N[0],m.value]),N[0]){case 0:case 1:m=N;break;case 4:return l.label++,{value:N[1],done:!1};case 5:l.label++,g=N[1],N=[0];continue;case 7:N=l.ops.pop(),l.trys.pop();continue;default:if(!(m=(m=l.trys).length>0&&m[m.length-1])&&(6===N[0]||2===N[0])){l=0;continue}if(3===N[0]&&(!m||N[1]>m[0]&&N[1]<m[3])){l.label=N[1];break}if(6===N[0]&&l.label<m[1]){l.label=m[1],m=N;break}if(m&&l.label<m[2]){l.label=m[2],l.ops.push(N);break}m[2]&&l.ops.pop(),l.trys.pop();continue}N=a.call(p,l)}catch(b){N=[6,b],g=0}finally{f=m=0}if(5&N[0])throw N[1];return{value:N[0]?N[1]:void 0,done:!0}}([N,b])}}},si=function(p){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l,a=p[Symbol.asyncIterator];return a?a.call(p):(p="function"==typeof __values?__values(p):p[Symbol.iterator](),l={},f("next"),f("throw"),f("return"),l[Symbol.asyncIterator]=function(){return this},l);function f(m){l[m]=p[m]&&function(E){return new Promise(function(w,x){!function g(m,E,w,x){Promise.resolve(x).then(function(N){m({value:N,done:w})},E)}(w,x,(E=p[m](E)).done,E.value)})}}},Un=function(p){return this instanceof Un?(this.v=p,this):new Un(p)},el=function(p){var a=typeof p;return"string"===a||"number"===a},ai=new DataView(new ArrayBuffer(0)),tl=new Uint8Array(ai.buffer),As=function(){try{ai.getInt8(0)}catch(p){return p.constructor}throw new Error("never reached")}(),Ps=new As("Insufficient data"),nl=new Yc,Rs=function(){function p(a,l,f,g,m,E,w,x){void 0===a&&(a=Ns.defaultCodec),void 0===l&&(l=void 0),void 0===f&&(f=on),void 0===g&&(g=on),void 0===m&&(m=on),void 0===E&&(E=on),void 0===w&&(w=on),void 0===x&&(x=nl),this.extensionCodec=a,this.context=l,this.maxStrLength=f,this.maxBinLength=g,this.maxArrayLength=m,this.maxMapLength=E,this.maxExtLength=w,this.keyDecoder=x,this.totalPos=0,this.pos=0,this.view=ai,this.bytes=tl,this.headByte=-1,this.stack=[]}return p.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=-1,this.stack.length=0},p.prototype.setBuffer=function(a){this.bytes=zr(a),this.view=function Gc(p){if(p instanceof ArrayBuffer)return new DataView(p);var a=zr(p);return new DataView(a.buffer,a.byteOffset,a.byteLength)}(this.bytes),this.pos=0},p.prototype.appendBuffer=function(a){if(-1!==this.headByte||this.hasRemaining(1)){var l=this.bytes.subarray(this.pos),f=zr(a),g=new Uint8Array(l.length+f.length);g.set(l),g.set(f,l.length),this.setBuffer(g)}else this.setBuffer(a)},p.prototype.hasRemaining=function(a){return this.view.byteLength-this.pos>=a},p.prototype.createExtraByteError=function(a){var f=this.view;return new RangeError("Extra ".concat(f.byteLength-this.pos," of ").concat(f.byteLength," byte(s) found at buffer[").concat(a,"]"))},p.prototype.decode=function(a){this.reinitializeState(),this.setBuffer(a);var l=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return l},p.prototype.decodeMulti=function(a){return Gr(this,function(l){switch(l.label){case 0:this.reinitializeState(),this.setBuffer(a),l.label=1;case 1:return this.hasRemaining(1)?[4,this.doDecodeSync()]:[3,3];case 2:return l.sent(),[3,1];case 3:return[2]}})},p.prototype.decodeAsync=function(a){var l,f,g,m;return function(p,a,l,f){return new(l||(l=Promise))(function(m,E){function w(b){try{N(f.next(b))}catch(Q){E(Q)}}function x(b){try{N(f.throw(b))}catch(Q){E(Q)}}function N(b){b.done?m(b.value):function g(m){return m instanceof l?m:new l(function(E){E(m)})}(b.value).then(w,x)}N((f=f.apply(p,a||[])).next())})}(this,void 0,void 0,function(){var E,w,x,N,b,ne,te;return Gr(this,function(we){switch(we.label){case 0:E=!1,we.label=1;case 1:we.trys.push([1,6,7,12]),l=si(a),we.label=2;case 2:return[4,l.next()];case 3:if((f=we.sent()).done)return[3,5];if(x=f.value,E)throw this.createExtraByteError(this.totalPos);this.appendBuffer(x);try{w=this.doDecodeSync(),E=!0}catch(Tt){if(!(Tt instanceof As))throw Tt}this.totalPos+=this.pos,we.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return N=we.sent(),g={error:N},[3,12];case 7:return we.trys.push([7,,10,11]),f&&!f.done&&(m=l.return)?[4,m.call(l)]:[3,9];case 8:we.sent(),we.label=9;case 9:return[3,11];case 10:if(g)throw g.error;return[7];case 11:return[7];case 12:if(E){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,w]}throw ne=(b=this).pos,te=b.totalPos,new RangeError("Insufficient data in parsing ".concat(ii(b.headByte)," at ").concat(te," (").concat(ne," in the current buffer)"))}})})},p.prototype.decodeArrayStream=function(a){return this.decodeMultiAsync(a,!0)},p.prototype.decodeStream=function(a){return this.decodeMultiAsync(a,!1)},p.prototype.decodeMultiAsync=function(a,l){return function(p,a,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var g,f=l.apply(p,a||[]),m=[];return g={},E("next"),E("throw"),E("return"),g[Symbol.asyncIterator]=function(){return this},g;function E(ne){f[ne]&&(g[ne]=function(te){return new Promise(function(we,Tt){m.push([ne,te,we,Tt])>1||w(ne,te)})})}function w(ne,te){try{!function x(ne){ne.value instanceof Un?Promise.resolve(ne.value.v).then(N,b):Q(m[0][2],ne)}(f[ne](te))}catch(we){Q(m[0][3],we)}}function N(ne){w("next",ne)}function b(ne){w("throw",ne)}function Q(ne,te){ne(te),m.shift(),m.length&&w(m[0][0],m[0][1])}}(this,arguments,function(){var g,m,E,w,x,N,b,Q,ne;return Gr(this,function(te){switch(te.label){case 0:g=l,m=-1,te.label=1;case 1:te.trys.push([1,13,14,19]),E=si(a),te.label=2;case 2:return[4,Un(E.next())];case 3:if((w=te.sent()).done)return[3,12];if(x=w.value,l&&0===m)throw this.createExtraByteError(this.totalPos);this.appendBuffer(x),g&&(m=this.readArraySize(),g=!1,this.complete()),te.label=4;case 4:te.trys.push([4,9,,10]),te.label=5;case 5:return[4,Un(this.doDecodeSync())];case 6:return[4,te.sent()];case 7:return te.sent(),0==--m?[3,8]:[3,5];case 8:return[3,10];case 9:if(!((N=te.sent())instanceof As))throw N;return[3,10];case 10:this.totalPos+=this.pos,te.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return b=te.sent(),Q={error:b},[3,19];case 14:return te.trys.push([14,,17,18]),w&&!w.done&&(ne=E.return)?[4,Un(ne.call(E))]:[3,16];case 15:te.sent(),te.label=16;case 16:return[3,18];case 17:if(Q)throw Q.error;return[7];case 18:return[7];case 19:return[2]}})})},p.prototype.doDecodeSync=function(){e:for(;;){var a=this.readHeadByte(),l=void 0;if(a>=224)l=a-256;else if(a<192)if(a<128)l=a;else if(a<144){if(0!=(f=a-128)){this.pushMapState(f),this.complete();continue e}l={}}else if(a<160){if(0!=(f=a-144)){this.pushArrayState(f),this.complete();continue e}l=[]}else l=this.decodeUtf8String(g=a-160,0);else if(192===a)l=null;else if(194===a)l=!1;else if(195===a)l=!0;else if(202===a)l=this.readF32();else if(203===a)l=this.readF64();else if(204===a)l=this.readU8();else if(205===a)l=this.readU16();else if(206===a)l=this.readU32();else if(207===a)l=this.readU64();else if(208===a)l=this.readI8();else if(209===a)l=this.readI16();else if(210===a)l=this.readI32();else if(211===a)l=this.readI64();else if(217===a){var g=this.lookU8();l=this.decodeUtf8String(g,1)}else if(218===a)g=this.lookU16(),l=this.decodeUtf8String(g,2);else if(219===a)g=this.lookU32(),l=this.decodeUtf8String(g,4);else if(220===a){if(0!==(f=this.readU16())){this.pushArrayState(f),this.complete();continue e}l=[]}else if(221===a){if(0!==(f=this.readU32())){this.pushArrayState(f),this.complete();continue e}l=[]}else if(222===a){if(0!==(f=this.readU16())){this.pushMapState(f),this.complete();continue e}l={}}else if(223===a){if(0!==(f=this.readU32())){this.pushMapState(f),this.complete();continue e}l={}}else if(196===a){var f=this.lookU8();l=this.decodeBinary(f,1)}else if(197===a)f=this.lookU16(),l=this.decodeBinary(f,2);else if(198===a)f=this.lookU32(),l=this.decodeBinary(f,4);else if(212===a)l=this.decodeExtension(1,0);else if(213===a)l=this.decodeExtension(2,0);else if(214===a)l=this.decodeExtension(4,0);else if(215===a)l=this.decodeExtension(8,0);else if(216===a)l=this.decodeExtension(16,0);else if(199===a)f=this.lookU8(),l=this.decodeExtension(f,1);else if(200===a)f=this.lookU16(),l=this.decodeExtension(f,2);else{if(201!==a)throw new Ut("Unrecognized type byte: ".concat(ii(a)));f=this.lookU32(),l=this.decodeExtension(f,4)}this.complete();for(var m=this.stack;m.length>0;){var E=m[m.length-1];if(0===E.type){if(E.array[E.position]=l,E.position++,E.position!==E.size)continue e;m.pop(),l=E.array}else{if(1===E.type){if(!el(l))throw new Ut("The type of key must be string or number but "+typeof l);if("__proto__"===l)throw new Ut("The key __proto__ is not allowed");E.key=l,E.type=2;continue e}if(E.map[E.key]=l,E.readCount++,E.readCount!==E.size){E.key=null,E.type=1;continue e}m.pop(),l=E.map}}return l}},p.prototype.readHeadByte=function(){return-1===this.headByte&&(this.headByte=this.readU8()),this.headByte},p.prototype.complete=function(){this.headByte=-1},p.prototype.readArraySize=function(){var a=this.readHeadByte();switch(a){case 220:return this.readU16();case 221:return this.readU32();default:if(a<160)return a-144;throw new Ut("Unrecognized array type byte: ".concat(ii(a)))}},p.prototype.pushMapState=function(a){if(a>this.maxMapLength)throw new Ut("Max length exceeded: map length (".concat(a,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:1,size:a,key:null,readCount:0,map:{}})},p.prototype.pushArrayState=function(a){if(a>this.maxArrayLength)throw new Ut("Max length exceeded: array length (".concat(a,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:0,size:a,array:new Array(a),position:0})},p.prototype.decodeUtf8String=function(a,l){var f;if(a>this.maxStrLength)throw new Ut("Max length exceeded: UTF-8 byte length (".concat(a,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+l+a)throw Ps;var m,g=this.pos+l;return m=this.stateIsMapKey()&&null!==(f=this.keyDecoder)&&void 0!==f&&f.canBeCached(a)?this.keyDecoder.decode(this.bytes,g,a):a>Vc?function zf(p,a,l){var f=p.subarray(a,a+l);return Fc.decode(f)}(this.bytes,g,a):Lc(this.bytes,g,a),this.pos+=l+a,m},p.prototype.stateIsMapKey=function(){return this.stack.length>0&&1===this.stack[this.stack.length-1].type},p.prototype.decodeBinary=function(a,l){if(a>this.maxBinLength)throw new Ut("Max length exceeded: bin length (".concat(a,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining(a+l))throw Ps;var f=this.pos+l,g=this.bytes.subarray(f,f+a);return this.pos+=l+a,g},p.prototype.decodeExtension=function(a,l){if(a>this.maxExtLength)throw new Ut("Max length exceeded: ext length (".concat(a,") > maxExtLength (").concat(this.maxExtLength,")"));var f=this.view.getInt8(this.pos+l),g=this.decodeBinary(a,l+1);return this.extensionCodec.decode(g,f,this.context)},p.prototype.lookU8=function(){return this.view.getUint8(this.pos)},p.prototype.lookU16=function(){return this.view.getUint16(this.pos)},p.prototype.lookU32=function(){return this.view.getUint32(this.pos)},p.prototype.readU8=function(){var a=this.view.getUint8(this.pos);return this.pos++,a},p.prototype.readI8=function(){var a=this.view.getInt8(this.pos);return this.pos++,a},p.prototype.readU16=function(){var a=this.view.getUint16(this.pos);return this.pos+=2,a},p.prototype.readI16=function(){var a=this.view.getInt16(this.pos);return this.pos+=2,a},p.prototype.readU32=function(){var a=this.view.getUint32(this.pos);return this.pos+=4,a},p.prototype.readI32=function(){var a=this.view.getInt32(this.pos);return this.pos+=4,a},p.prototype.readU64=function(){var a=function kc(p,a){return 4294967296*p.getUint32(a)+p.getUint32(a+4)}(this.view,this.pos);return this.pos+=8,a},p.prototype.readI64=function(){var a=ti(this.view,this.pos);return this.pos+=8,a},p.prototype.readF32=function(){var a=this.view.getFloat32(this.pos);return this.pos+=4,a},p.prototype.readF64=function(){var a=this.view.getFloat64(this.pos);return this.pos+=8,a},p}();class sn{static write(a){let l=a.byteLength||a.length;const f=[];do{let m=127&l;l>>=7,l>0&&(m|=128),f.push(m)}while(l>0);l=a.byteLength||a.length;const g=new Uint8Array(f.length+l);return g.set(f,0),g.set(a,f.length),g.buffer}static parse(a){const l=[],f=new Uint8Array(a),m=[0,7,14,21,28];for(let E=0;E<a.byteLength;){let N,w=0,x=0;do{N=f[E+w],x|=(127&N)<<m[w],w++}while(w<Math.min(5,a.byteLength-E)&&128&N);if(128&N&&w<5)throw new Error("Cannot read message size.");if(5===w&&N>7)throw new Error("Messages bigger than 2GB are not supported.");if(!(f.byteLength>=E+w+x))throw new Error("Incomplete message.");l.push(f.slice?f.slice(E+w,E+w+x):f.subarray(E+w,E+w+x)),E=E+w+x}return l}}const rl=new Uint8Array([145,B.Ping]);class Zf{constructor(a){this.name="messagepack",this.version=2,this.transferFormat=mt.Binary,this._errorResult=1,this._voidResult=2,this._nonVoidResult=3,this._encoder=new Zc((a=a||{}).extensionCodec,a.context,a.maxDepth,a.initialBufferSize,a.sortKeys,a.forceFloat32,a.ignoreUndefined,a.forceIntegerToFloat),this._decoder=new Rs(a.extensionCodec,a.context,a.maxStrLength,a.maxBinLength,a.maxArrayLength,a.maxMapLength,a.maxExtLength)}parseMessages(a,l){if(!function ci(p){return p&&typeof ArrayBuffer<"u"&&(p instanceof ArrayBuffer||p.constructor&&"ArrayBuffer"===p.constructor.name)}(a))throw new Error("Invalid input for MessagePack hub protocol. Expected an ArrayBuffer.");null===l&&(l=rn.instance);const f=sn.parse(a),g=[];for(const m of f){const E=this._parseMessage(m,l);E&&g.push(E)}return g}writeMessage(a){switch(a.type){case B.Invocation:return this._writeInvocation(a);case B.StreamInvocation:return this._writeStreamInvocation(a);case B.StreamItem:return this._writeStreamItem(a);case B.Completion:return this._writeCompletion(a);case B.Ping:return sn.write(rl);case B.CancelInvocation:return this._writeCancelInvocation(a);case B.Close:return this._writeClose();case B.Ack:return this._writeAck(a);case B.Sequence:return this._writeSequence(a);default:throw new Error("Invalid message type.")}}_parseMessage(a,l){if(0===a.length)throw new Error("Invalid payload.");const f=this._decoder.decode(a);if(0===f.length||!(f instanceof Array))throw new Error("Invalid payload.");const g=f[0];switch(g){case B.Invocation:return this._createInvocationMessage(this._readHeaders(f),f);case B.StreamItem:return this._createStreamItemMessage(this._readHeaders(f),f);case B.Completion:return this._createCompletionMessage(this._readHeaders(f),f);case B.Ping:return this._createPingMessage(f);case B.Close:return this._createCloseMessage(f);case B.Ack:return this._createAckMessage(f);case B.Sequence:return this._createSequenceMessage(f);default:return l.log(R.Information,"Unknown message type '"+g+"' ignored."),null}}_createCloseMessage(a){if(a.length<2)throw new Error("Invalid payload for Close message.");return{allowReconnect:a.length>=3?a[2]:void 0,error:a[1],type:B.Close}}_createPingMessage(a){if(a.length<1)throw new Error("Invalid payload for Ping message.");return{type:B.Ping}}_createInvocationMessage(a,l){if(l.length<5)throw new Error("Invalid payload for Invocation message.");const f=l[2];return f?{arguments:l[4],headers:a,invocationId:f,streamIds:[],target:l[3],type:B.Invocation}:{arguments:l[4],headers:a,streamIds:[],target:l[3],type:B.Invocation}}_createStreamItemMessage(a,l){if(l.length<4)throw new Error("Invalid payload for StreamItem message.");return{headers:a,invocationId:l[2],item:l[3],type:B.StreamItem}}_createCompletionMessage(a,l){if(l.length<4)throw new Error("Invalid payload for Completion message.");const f=l[3];if(f!==this._voidResult&&l.length<5)throw new Error("Invalid payload for Completion message.");let g,m;switch(f){case this._errorResult:g=l[4];break;case this._nonVoidResult:m=l[4]}return{error:g,headers:a,invocationId:l[2],result:m,type:B.Completion}}_createAckMessage(a){if(a.length<1)throw new Error("Invalid payload for Ack message.");return{sequenceId:a[1],type:B.Ack}}_createSequenceMessage(a){if(a.length<1)throw new Error("Invalid payload for Sequence message.");return{sequenceId:a[1],type:B.Sequence}}_writeInvocation(a){let l;return l=this._encoder.encode(a.streamIds?[B.Invocation,a.headers||{},a.invocationId||null,a.target,a.arguments,a.streamIds]:[B.Invocation,a.headers||{},a.invocationId||null,a.target,a.arguments]),sn.write(l.slice())}_writeStreamInvocation(a){let l;return l=this._encoder.encode(a.streamIds?[B.StreamInvocation,a.headers||{},a.invocationId,a.target,a.arguments,a.streamIds]:[B.StreamInvocation,a.headers||{},a.invocationId,a.target,a.arguments]),sn.write(l.slice())}_writeStreamItem(a){const l=this._encoder.encode([B.StreamItem,a.headers||{},a.invocationId,a.item]);return sn.write(l.slice())}_writeCompletion(a){const l=a.error?this._errorResult:void 0!==a.result?this._nonVoidResult:this._voidResult;let f;switch(l){case this._errorResult:f=this._encoder.encode([B.Completion,a.headers||{},a.invocationId,l,a.error]);break;case this._voidResult:f=this._encoder.encode([B.Completion,a.headers||{},a.invocationId,l]);break;case this._nonVoidResult:f=this._encoder.encode([B.Completion,a.headers||{},a.invocationId,l,a.result])}return sn.write(f.slice())}_writeCancelInvocation(a){const l=this._encoder.encode([B.CancelInvocation,a.headers||{},a.invocationId]);return sn.write(l.slice())}_writeClose(){const a=this._encoder.encode([B.Close,null]);return sn.write(a.slice())}_writeAck(a){const l=this._encoder.encode([B.Ack,a.sequenceId]);return sn.write(l.slice())}_writeSequence(a){const l=this._encoder.encode([B.Sequence,a.sequenceId]);return sn.write(l.slice())}_readHeaders(a){const l=a[1];if("object"!=typeof l)throw new Error("Invalid headers.");return l}}var ks={},il=Ft(953);let sl=null;function Os(){return Os=(0,J.A)(function*(p){try{sl?.dispose();const a=(0,il.naY)()?"https://localhost:4200/api/MoveBank-Hub":"https://api.wildlife-tracker.com/api/MoveBank-Hub",l=(new ei).configureLogging(R.Debug).withUrl(a,{withCredentials:!1}).withHubProtocol(new Zf).withStatefulReconnect().build();yield l.start(),sl=l.stream("StreamEvents",p.request).subscribe({next:g=>{const m=function Qf(p,a){return void 0===a&&(a=ks),new Rs(a.extensionCodec,a.context,a.maxStrLength,a.maxBinLength,a.maxArrayLength,a.maxMapLength,a.maxExtLength).decode(p)}(g),E=function ll(p){const l=p[1],f=p[2],g=p[3];return{features:p[0].map(ul),individualLocalIdentifier:l,count:f,index:g}}(m);(function cl(p,a){return Ls.apply(this,arguments)})(E,"BinaryLineString").then(w=>{null!==w&&postMessage(w[0],w[1])})},complete:()=>{postMessage({type:"StreamEnded"})},error:g=>{console.error(g),postMessage({type:"StreamError"})}})}catch(a){console.error(a)}}),Os.apply(this,arguments)}function Ls(){return(Ls=(0,J.A)(function*(p,a){if(0===p.count)return null;const l=p.features,g=Ct(l).lines;return void 0===g||0===l.length?null:function dl(p,a,l){const g=function Yf(p){const a=new TextEncoder;return{contentArray:p.map(f=>a.encode(f.content).buffer)}}(p.properties),m=function Hn(p){const a=p,l=Object.keys(a),f=[],g=new Map;for(const E of l){const w=p[E];f.push(w.value.buffer),g.set(E,{size:w.size,value:w.value.buffer})}return[{sourceTimestamp:{size:a.sourceTimestamp.size,value:a.sourceTimestamp.value.buffer},destinationTimestamp:{size:a.destinationTimestamp.size,value:a.destinationTimestamp.value.buffer},distanceKm:{size:a.distanceKm?.size??2,value:a.distanceKm.value.buffer},distanceTravelledKm:{size:a.distanceTravelledKm.size,value:a.distanceTravelledKm.value.buffer}},f]}(p.numericProps),E={type:l,index:a.index,length:a.count,individualLocalIdentifier:a.individualLocalIdentifier,featureId:li(p.featureIds),globalFeatureIds:li(p.globalFeatureIds),pathIndices:li(p.pathIndices),position:li(p.positions),colors:fl(g.contentArray.length),numericProps:m[0],content:g};return[E,[E.featureId.value,E.globalFeatureIds.value,E.pathIndices.value,E.position.value,...m[1],...g.contentArray]]}(g,p,a)})).apply(this,arguments)}function ul(p){const l=p[2];return{type:"Feature",geometry:{type:"LineString",coordinates:p[1][1]},properties:{sourceTimestamp:l[0],destinationTimestamp:l[1],content:l[2],distanceKm:l[3],distanceTravelledKm:l[4]}}}function fl(p){const a=[];for(let l=0;l<p;l++)a.push(...Fs()),a.push(...Fs());return{size:4,value:new Uint8Array(a).buffer}}function Fs(){const p=[0,0,0,0];for(let a=0;a<3;a++)p[a]=Math.round(255*Math.random());return p[3]=255,p}function li(p){return{size:p.size,value:p.value.buffer}}addEventListener("message",({data:p})=>{"FetchRequest"===p.type&&function al(p){Os.apply(this,arguments)}(p.data)})})()})();