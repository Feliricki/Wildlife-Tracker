<mat-tab-group preserveContent animationDuration="0ms">
  <mat-tab label="Individuals">
    @switch (TableState()){
    @case ("initial"){
    <span>Initial State</span>
    }

    @case ("loading"){
    <span>Loading State</span>
    }

    @case ("error"){
    <span>Http Error</span>
    }
    }

    <form [formGroup]="eventForm">

      <mat-form-field>

        <mat-label>Enter a date range.</mat-label>
        <mat-date-range-input [rangePicker]="picker" formGroupName="dateRange">
          <input matStartDate formControlName="start" placeholder="Start Date">
          <input matEndDate formControlName="end" placeholder="End Date">
        </mat-date-range-input>

        <mat-hint>MM/DD/YYYY â€“ MM/DD/YYYY</mat-hint>
        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-date-range-picker #picker></mat-date-range-picker>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Event Profile</mat-label>
        <mat-select formControlName="eventProfiles" matTooltip="Some information.">

          <mat-option [value]="null">None</mat-option>
          <mat-divider></mat-divider>
          <mat-option value="EURING_01">24 hours between events.</mat-option>
          <mat-divider></mat-divider>
          <mat-option value="EURING_02">50 kilometers between events.</mat-option>
          <mat-divider></mat-divider>
          <mat-option value="EURING_03">Last 30 days.</mat-option>
          <mat-divider></mat-divider>
          <mat-option value="EURING_04">0.25 degrees movement.</mat-option>

        </mat-select>
      </mat-form-field>

      <!-- TODO: Finalize using the formArray as the input source. -->
      <!-- This error warning should only display if individuals have loaded in. -->
      @if (eventForm.dirty && eventForm.hasError("noOptionSelected")){
      <mat-error>No Option Selected.</mat-error>
      }

      <table mat-table formArrayName="checkboxes" matSort matSortDisableClear matSortActive="name"
        matSortDirection="asc" (SortChange)="sortChange()" [dataSource]="tableSource" #Table [trackBy]="trackById"
        class="animal-table">

        <!-- Checkbox Column -->
        <ng-container matColumnDef="select">
          <th mat-header-cell *matHeaderCellDef>

            <mat-checkbox [checked]="hasValue() && isAllSelected()" [indeterminate]="hasValue() && !isAllSelected()"
              (change)="$event ? toggleAllRows() : null"></mat-checkbox>

          </th>

          <!-- TODO: Decide if a form needs to be used or if a request can be made with the selectionModel only -->
          <!-- And set the aria-label -->
          <td mat-cell *matCellDef="let control; let j = index;" class="checkbox-header-cell">

            <mat-checkbox [formControlName]="j" (click)="$event.stopPropagation()" (change)="toggleRow(j)"
              [id]="j"></mat-checkbox>

          </td>

        </ng-container>

        <ng-container matColumnDef="name" class="ng-container">

          <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by name">
            <span>Local Identifiers</span>
            <span># Individuals = {{Individuals().size}}</span>
            <span># Tagged = {{TaggedIndividuals().size}}</span>
            <mat-icon matTooltip="A unique individual identifier provided by the owner of the study." aria-label="false"
              fontIcon="info"></mat-icon>
          </th>

          <!-- TODO: Set the value attribute to the local identifier. -->
          <!-- INFO: This the templating for the individual local identifiers -->
          <td mat-cell *matCellDef="let control; let j = index;" class="individual-header-cell">
            <!-- Format is [isSelected) as boolean, and a string representing the name]-->
            <!-- <span>TableState ={{TableState()}}</span> -->
            <p>IsTagged = {{isTagged(j)()}}</p>
            <p>{{getIndividual(j)()?.LocalIdentifier ?? "N/A" }}</p>

          </td>
        </ng-container>


        <tr mat-header-row class="header-row" *matHeaderRowDef="displayedColumns; sticky:true"></tr>
        <tr mat-row class="rows" *matRowDef="let row; let i = index; columns:displayedColumns;"></tr>
      </table>

    </form>

  </mat-tab>

  <mat-tab label="Event Information">
    <p>Some text.</p>
  </mat-tab>
</mat-tab-group>
