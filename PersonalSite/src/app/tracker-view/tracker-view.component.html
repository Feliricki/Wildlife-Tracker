<!-- <div class="main-content"> -->
<mat-sidenav-container class="sidenav-container" [hasBackdrop]="false">

  <!-- NOTE: Change the opened state to false later. -->
  <!-- <mat-sidenav #sidenav mode="over" [opened]="true" [fixedInViewport]="true" class="sidenav" [disableClose]="true" -->
  <!--   [ngStyle]="(XSmallScreen | async) ? leftNavSmallStyle : leftNavLargeStyle"> -->
  <mat-sidenav #sidenav mode="over" [opened]="true" [fixedInViewport]="true" class="sidenav" [disableClose]="true"
    [ngStyle]="(XSmallScreen$ | async) ? leftNavSmallStyle : leftNavLargeStyle">

    <div class="search-container">

      <!-- BUG:Issues are being caused by some component. Conditionally remove the components until the issue goes away. -->
      @if(sidenav.opened || searchOpened()){
      <app-simple-search [hidden]="!searchOpened" [allStudies]="currentStudies" (closeComponent)="closeSearchNav()"
        (componentInitialized)="initializeSearchNav()"
        (panToMarkerEvent)="updateCurrentMarkers($event)"></app-simple-search>
      }

    </div>
  </mat-sidenav>
  <mat-sidenav-content class="sidenav-content">

    <!-- NOTE: This is another sidenav within the outer sidenav -->
    <mat-sidenav class="right-sidenav" #rightSidenav [opened]="false" position="end" [disableClose]="true" mode="over"
      [fixedInViewport]="true">
      <!-- <mat-sidenav class="right-sidenav" #rightSidenav [opened]="false" position="end" [disableClose]="true" mode="side" -->
      <!--   [fixedInViewport]="true"> -->

      <app-events #eventComponent (eventRequestEmitter)="updateCurrentEventRequest($event)"
        (closeRightNavEmitter)="closeRightNav()" [currentStudy]="currentStudy" [currentEventData]="currentChunkInfo"
        [streamStatus]="currentStreamStatus"></app-events>

    </mat-sidenav>

    <!-- NOTE:This is where the actual content lies. -->
    <mat-sidenav-content class="sidenav-content-right">

      @if(mapLoaded()){
      <mat-toolbar class="dense-3" id="toolbar">
        <!-- <button mat-mini-fab color="primary" class="home-button"><mat-icon>home</mat-icon></button> -->
        <!-- <button mat-mini-fab><mat-icon>menu</mat-icon></button> -->

        <!-- <button mat-raised-button class="rounded"> -->
        <!--   <mat-icon>layers</mat-icon>Layers -->
        <!-- </button> -->

        <!-- TODO:Make a custom toggle group. -->
        <!-- <button mat-fab extended> -->
        <!--   <span style="border-right-style:groove;">Map</span> -->
        <!--   <span>Satellite</span> -->
        <!-- </button> -->
        <!-- <button mat-raised-button> -->
        <!--   <span style="border-right-style:groove;">Map </span> -->
        <!--   <span>Satellite</span> -->
        <!-- </button> -->

        <!-- <mat-button-toggle-group appearance="legacy" class="toggle-group"> -->
        <!-- TODO:Include an options for the label being clicked. -->

        <!-- <mat-chip-listbox class="chip-listbox" aria-label="Map Style"> -->
        <!--   <mat-chip-option (click)="setMapType('roadmap')" color="primary" selected>Map</mat-chip-option> -->
        <!--   <mat-chip-option (click)="setMapType('hybrid')" color="primary">Satellite</mat-chip-option> -->
        <!--   <!-- <mat-chip-option color="accent">Satellite</mat-chip-option> -->
        <!--   <!-- <mat-chip-option color="warn">Satellite</mat-chip-option> -->
        <!-- </mat-chip-listbox> -->

        <div class="toolbar-elements" [ngStyle]="(XSmallScreen$ | async) ? toolbarOffsetSmall : toolbarOffset">

          @if (XSmallScreen$ | async){
          <button mat-mini-fab id="mini-fab-layer" class="extended-fab" [matMenuTriggerFor]="layerMenu">
            <mat-icon>layers</mat-icon>
          </button>
          }
          @else {
          <button mat-fab extended matRipple class="extended-fab" [matMenuTriggerFor]="layerMenu">
            <mat-icon>layers</mat-icon>Layers
          </button>
          }

          <mat-menu #layerMenu="matMenu" xPosition="after" yPosition="below">
            <mat-radio-group class="layer-radio-group">
              @for(layerOptions of layerMenuOptions; track layerOptions[0]){
              <mat-radio-button [value]="layerOptions[1]" class="layer-radio-button">{{layerOptions[0]}}</mat-radio-button>
              }
            </mat-radio-group>
          </mat-menu>

          <mat-button-toggle-group class="toggle-group">
            <mat-button-toggle (click)="setMapType(checkboxMap.checked ? 'terrain' : 'roadmap')"
              [matMenuTriggerFor]="roadMap">
              <mat-icon>map</mat-icon>Map
              <!-- Map -->
            </mat-button-toggle>
            <mat-button-toggle (click)="setMapType(checkboxSatellite.checked ? 'hybrid' : 'satellite')"
              [matMenuTriggerFor]="Satellitemenu">
              <mat-icon>satellite</mat-icon>Satellite
            </mat-button-toggle>

            <mat-menu #roadMap="matMenu" xPosition="after" yPosition="below">
              <button mat-menu-item><mat-checkbox #checkboxMap color="primary" value="roadmap"
                  (change)="setMapTypeCheckbox($event)">Terrain</mat-checkbox></button>
            </mat-menu>

            <mat-menu #Satellitemenu="matMenu" xPosition="after" yPosition="below">
              <button mat-menu-item><mat-checkbox #checkboxSatellite color="primary" value="satellite"
                  (change)="setMapTypeCheckbox($event)">Label</mat-checkbox></button>
            </mat-menu>
          </mat-button-toggle-group>

          <!-- TODO:Finish this button for toggling all markers' visibility -->
          <button mat-mini-fab matRipple class="marker-toggle" (click)="toggleMarkerVisibility()"
            aria-label="test label">
            @if(!markersVisible()){
            <mat-icon>location_on</mat-icon>
            } @else {
            <mat-icon>location_off</mat-icon>
            }
          </button>
        </div>

      </mat-toolbar>
      }

      @if (leftButtonFlag() === true){
      <button mat-fab [hidden]="!leftButtonFlag()" @leftToggleClick (click)="openSearchNav()"
        class="toggle-button"><mat-icon>chevron_right</mat-icon></button>
      }
      <!-- TODO: Move the toggle button belongs the search component -->
      <!-- Fix the search component's spinner element position. -->
      @if (activeMap === "google"){
      <app-google-map [pathEventData$]="currentEventLineData$" (mapStateEmitter)="updateMapState($event)"
        (studiesEmitter)="updateCurrentStudies($event)" (studyEmitter)="updateCurrentStudy($event)"
        [focusedMarker]="currentMarker" [eventRequest]="currentEventRequest" [mapType]="currentMapType"
        [selectedLayer]="currentLayer()" (chunkInfoEmitter)="updateChunkMetadata($event)"
        (streamStatusEmitter)="updateStreamState($event)" [markersVisible]="markersVisible()">
      </app-google-map>
      }

      @if (rightButtonFlag() === true && mapLoaded()){
      <button mat-fab @rightToggleClick (click)="openRightNav()"
        class="right-toggle-button"><mat-icon>chevron_left</mat-icon></button>
      }

    </mat-sidenav-content>

  </mat-sidenav-content>
</mat-sidenav-container>
