<!-- NOTE:Mobile devices cannot have this button on screen. The old open button can be used instead. -->
<!-- If a extra small screem is detected then this button can be disable  -->
@if (!(XSmallScreen$ | async)){
<button mat-fab [hidden]="!mapLoaded()" class="left-toggle-button" (click)="toggleSearchNav()"
  [@leftPanelOpened]="leftPanelOpened() ? true : false">
  @if(leftPanelOpened()){
  <mat-icon>chevron_left</mat-icon>
  } @else {
  <mat-icon>chevron_right</mat-icon>
  }
</button>
}

<mat-sidenav-container class="sidenav-container" [hasBackdrop]="false">

  <!-- NOTE: Change the opened state to false later. -->
  <!-- <mat-sidenav #sidenav mode="over" [opened]="true" [fixedInViewport]="true" class="sidenav" [disableClose]="true" -->
  <!--   [ngStyle]="(XSmallScreen | async) ? leftNavSmallStyle : leftNavLargeStyle"> -->
  <mat-sidenav #sidenav mode="over" [opened]="true" [fixedInViewport]="true" class="sidenav" [disableClose]="true"
    [ngStyle]="(XSmallScreen$ | async) ? leftNavSmallStyle : leftNavLargeStyle">

    <div class="search-container">

      @if(sidenav.opened || searchOpened()){
      <app-simple-search [hidden]="!searchOpened" [allStudies]="currentStudies" (closeComponent)="closeSearchNav()"
        (componentInitialized)="initializeSearchNav()"
        (panToMarkerEvent)="updateCurrentMarkers($event)"></app-simple-search>
      }

    </div>
  </mat-sidenav>
  <mat-sidenav-content class="sidenav-content">

    <!-- NOTE: This is another sidenav within the outer sidenav -->
    <mat-sidenav class="right-sidenav" #rightSidenav [opened]="false" position="end" [disableClose]="true" mode="side"
      [fixedInViewport]="true">

      <app-events #eventComponent (eventRequestEmitter)="updateCurrentEventRequest($event)"
        (closeRightNavEmitter)="closeRightNav()" [currentStudy]="currentStudy" [currentEventData]="currentChunkInfo"
        [streamStatus]="currentStreamStatus"></app-events>

    </mat-sidenav>

    <!-- NOTE:This is where the actual content lies. -->
    <mat-sidenav-content class="sidenav-content-right">

      @if(mapLoaded()){

      <!-- TODO:This toolbar needs to be replaced with a div or other container. -->
      <!-- Alternatively, the z-index of this element could be lowered or attributes could be set such as the width -->
      <div class="toolbar-container">

        <mat-toolbar class="dense-3" id="toolbar">

          <div class="toolbar-elements">

            <button mat-fab class="menu-button" color="primary" [matMenuTriggerFor]="mainMenu">
              <mat-icon>menu</mat-icon>
            </button>

            <!-- INFO:Main menu section-->
            <mat-menu #mainMenu="matMenu" xPosition="after" yPosition="below">
              <button mat-menu-item [matMenuTriggerFor]="settingsMenu">Settings</button>
            </mat-menu>

            <mat-menu #settingsMenu="matMenu">
              <button mat-menu-item [matMenuTriggerFor]="basemaps">Change Base Map</button>
            </mat-menu>

            <mat-menu #basemaps="matMenu" XPosition="before" yPosition="below">
              <button mat-menu-item (click)="setBaseMap('google')">
                Google Maps
              </button>
              <button mat-menu-item (click)="setBaseMap('mapbox')">
                Mapbox
              </button>
            </mat-menu>

            @if (XSmallScreen$ | async){
            <button mat-mini-fab id="mini-fab-layer" class="extended-fab" [matMenuTriggerFor]="layerMenu">
              <mat-icon>layers</mat-icon>
            </button>
            } @else {
            <button mat-fab extended matRipple class="extended-fab" [matMenuTriggerFor]="layerMenu">
              <mat-icon>layers</mat-icon>Layers
            </button>
            }

            <mat-menu #layerMenu="matMenu" xPosition="after" yPosition="below">
              <mat-radio-group class="layer-radio-group" [(ngModel)]="radioGroupValue">
                @for(layerOptions of layerMenuOptions; track layerOptions[0]){
                <mat-radio-button [value]="layerOptions[1]" (change)="layerOptionSelected($event)"
                  class="layer-radio-button">{{layerOptions[0]}}</mat-radio-button>
                }
              </mat-radio-group>
            </mat-menu>

            <mat-button-toggle-group class="toggle-group">

              <mat-button-toggle (click)="setMapTypeGoogle(checkboxMap.checked ? 'terrain' : 'roadmap')"
                [matMenuTriggerFor]="roadMap">
                <mat-icon>map</mat-icon>
                Map
              </mat-button-toggle>
              <mat-button-toggle (click)="setMapTypeGoogle(checkboxSatellite.checked ? 'hybrid' : 'satellite')"
                [matMenuTriggerFor]="Satellitemenu">
                <mat-icon>satellite</mat-icon>
                Satellite
              </mat-button-toggle>

              <mat-menu #roadMap="matMenu" xPosition="after" yPosition="below">

                <button mat-menu-item>
                  <mat-checkbox #checkboxMap color="primary" value="roadmap" (change)="setMapTypeCheckbox($event)">
                    Terrain
                  </mat-checkbox>
                </button>

              </mat-menu>

              <mat-menu #Satellitemenu="matMenu" xPosition="after" yPosition="below">
                <button mat-menu-item>
                  <mat-checkbox #checkboxSatellite color="primary" value="satellite"
                    (change)="setMapTypeCheckbox($event)">
                    Label
                  </mat-checkbox>
                </button>
              </mat-menu>
            </mat-button-toggle-group>

            <button mat-mini-fab matRipple class="marker-toggle" (click)="toggleMarkerVisibility()" color="primary">
              @if(!markersVisible()){
              <mat-icon>location_on</mat-icon>
              } @else {
              <mat-icon>location_off</mat-icon>
              }
            </button>
          </div>

        </mat-toolbar>

        <!-- NOTE: Inside the 'toolbar-container' div element -->
        <!-- <span class="spacer"></span> -->
        <!-- <button mat-icon-button class="settings-button"> -->
        <!--   <mat-icon>settings</mat-icon> -->
        <!-- </button> -->

        <!-- <button mat-fab class="settings-button" color="primary" [matMenuTriggerFor]="settingsMenu"> -->
        <!--   <mat-icon>settings</mat-icon> -->
        <!-- </button> -->
        <!-- TODO: Embed another menu within this menu to select a base map. In total include the follwoing options -->
        <!-- 1) Base maps (change these options depending on what is rate limited) -->
        <!-- <mat-menu #settingsMenu="matMenu" xPosition="before" yPosition="below"> -->
        <!--   <button mat-menu-item [matMenuTriggerFor]="basemaps">Base Maps</button> -->
        <!-- </mat-menu> -->


      </div>
      }

      <!-- TODO:I should write down in english what the conditions are for this flag to activate. -->
      <!-- This button is shown on smaller screens. -->
      @if (leftButtonFlag() === true && (XSmallScreen$ | async)){
      <button mat-fab [hidden]="!leftButtonFlag()" @leftToggleClick (click)="openSearchNav()" class="toggle-button">
        <mat-icon>chevron_right</mat-icon>
      </button>
      }

      <!-- TODO:This should be changed to a switch case after refactoring. -->
      @switch(activeMap()){

      @case("google"){
      <app-google-map [pathEventData$]="currentEventLineData$" (mapStateEmitter)="updateMapState($event)"
        (studiesEmitter)="updateCurrentStudies($event)" (studyEmitter)="updateCurrentStudy($event)"
        [focusedMarker]="currentMarker" [eventRequest]="currentEventRequest" [mapType]="currentMapType"
        [selectedLayer]="currentLayer()" (chunkInfoEmitter)="updateChunkMetadata($event)"
        (streamStatusEmitter)="updateStreamState($event)" [markersVisible]="markersVisible()">
      </app-google-map>
      }

      @case("mapbox") {
      <app-mapbox (mapStateEmitter)="updateMapState($event)" (studyEmitter)="updateCurrentStudy($event)"
        [focusedPoint]="currentMarker">
      </app-mapbox>
      }

      @default {
      <span>Default case for basemap switch case.</span>
      }

      }

      @if (rightButtonFlag() === true && mapLoaded()){
      <button mat-fab @rightToggleClick (click)="openRightNav()" class="right-toggle-button">
        <mat-icon>chevron_left</mat-icon>
      </button>
      }

    </mat-sidenav-content>

  </mat-sidenav-content>
</mat-sidenav-container>
